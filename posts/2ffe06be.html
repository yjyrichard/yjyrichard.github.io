<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><div id="myscoll"></div><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Langchain4j | Yangjiayu</title><meta name="keywords" content="java"><meta name="author" content="Yangjiayu"><meta name="copyright" content="Yangjiayu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="Langchain">
<meta property="og:type" content="article">
<meta property="og:title" content="Langchain4j">
<meta property="og:url" content="https://yjyrichard.github.io/posts/2ffe06be.html">
<meta property="og:site_name" content="Yangjiayu">
<meta property="og:description" content="Langchain">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://bilibili123.oss-cn-beijing.aliyuncs.com/websitepic/4.png">
<meta property="article:published_time" content="2025-06-05T13:24:25.548Z">
<meta property="article:modified_time" content="2025-06-08T07:00:41.816Z">
<meta property="article:author" content="Yangjiayu">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://bilibili123.oss-cn-beijing.aliyuncs.com/websitepic/4.png"><link rel="shortcut icon" href="https://bilibili123.oss-cn-beijing.aliyuncs.com/about/your_image_path_here.jpg"><link rel="canonical" href="https://yjyrichard.github.io/posts/2ffe06be"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/node-snackbar/0.1.16/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"var(--theme-color)","bgDark":"#191919","position":"top-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Langchain4j',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-06-08 15:00:41'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><style id="themeColor"></style><style id="rightSide"></style><style id="transPercent"></style><style id="blurNum"></style><style id="settingStyle"></style><span id="fps"></span><style id="defineBg"></style><style id="menu_shadow"></style><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Yangjiayu" type="application/atom+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bilibili123.oss-cn-beijing.aliyuncs.com/about/your_image_path_here.jpg" onerror="onerror=null;src='/assets/r1.jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">71</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> 首页</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pinweishenghuo"></use></svg><span class="menu_word" style="font-size:17px"> 休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yinle">                   </use></svg><span class="menu_word" style="font-size:17px"> 八音盒</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-dianying1">                   </use></svg><span class="menu_word" style="font-size:17px"> 影院</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-youxishoubing">                   </use></svg><span class="menu_word" style="font-size:17px"> 健身</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/books/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> 书籍</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pengyouquan">                   </use></svg><span class="menu_word" style="font-size:17px"> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-maoliang"></use></svg><span class="menu_word" style="font-size:17px"> 个人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/bb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-qunliaotian">                   </use></svg><span class="menu_word" style="font-size:17px"> 时间管理</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/love/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-love-sign">                   </use></svg><span class="menu_word" style="font-size:17px"> 恋爱小屋</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-paperplane">                   </use></svg><span class="menu_word" style="font-size:17px"> 关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Yangjiayu</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> 首页</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pinweishenghuo"></use></svg><span class="menu_word" style="font-size:17px"> 休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yinle">                   </use></svg><span class="menu_word" style="font-size:17px"> 八音盒</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-dianying1">                   </use></svg><span class="menu_word" style="font-size:17px"> 影院</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-youxishoubing">                   </use></svg><span class="menu_word" style="font-size:17px"> 健身</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/books/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> 书籍</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pengyouquan">                   </use></svg><span class="menu_word" style="font-size:17px"> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-maoliang"></use></svg><span class="menu_word" style="font-size:17px"> 个人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/bb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-qunliaotian">                   </use></svg><span class="menu_word" style="font-size:17px"> 时间管理</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/love/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-love-sign">                   </use></svg><span class="menu_word" style="font-size:17px"> 恋爱小屋</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-paperplane">                   </use></svg><span class="menu_word" style="font-size:17px"> 关于</span></a></li></ul></div></div><center id="name-container"><a id="page-name" href="javascript:scrollToTop()">PAGE_NAME</a></center><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="检索站内任何你想要的信息"><svg class="faa-tada icon" style="height:24px;width:24px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-valentine_-search-love-find-heart"></use></svg><span> 搜索</span></a></div><a class="meihua faa-parent animated-hover" onclick="toggleWinbox()" title="美化设置-自定义你的风格" id="meihua-button"><svg class="faa-tada icon" style="height:26px;width:26px;fill:currentColor;position:relative;top:8px" aria-hidden="true"><use xlink:href="#icon-tupian1"></use></svg></a><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="浅色和深色模式转换" id="nightmode-button"><svg class="faa-tada" style="height:25px;width:25px;fill:currentColor;position:relative;top:7px" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon">       </use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">Langchain4j</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-meta-icon" style="width:30px;height:30px;position:relative;top:10px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">发表于 </span><time class="post-meta-date-created" datetime="2025-06-05T13:24:25.548Z" title="发表于 2025-06-05 21:24:25">2025-06-05</time><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-gengxin1"></use></svg><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-06-08T07:00:41.816Z" title="更新于 2025-06-08 15:00:41">2025-06-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-biaoqian"></use></svg><a class="post-meta-categories" href="/categories/java/">java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:8px"><use xlink:href="#icon-charuword"></use></svg><span class="post-meta-label">字数总计:</span><span class="word-count">1.8w</span><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:20px;height:20px;position:relative;top:5px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">阅读时长:</span><span>69分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Langchain4j"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:5px"><use xlink:href="#icon-eye"></use></svg><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>[TOC]</p>
<h1>Langchain4j</h1>
<h2 id="前置知识">前置知识</h2>
<ul>
<li>
<p>Java基础</p>
</li>
<li>
<p>Maven</p>
</li>
<li>
<p>MySQL</p>
</li>
<li>
<p>SSM</p>
</li>
<li>
<p>SpringBoot</p>
</li>
</ul>
<h2 id="一、LangChain4j-入门">一、LangChain4j 入门</h2>
<h3 id="1、简介">1、简介</h3>
<p>LangChain4j 的目标是简化将大语言模型（LLM - Large Language Model）集成到 Java 应用程序中的过程。</p>
<h4 id="1-1、历史背景">1.1、历史背景</h4>
<p>2022 年11月30日OpenAI发布了Chat GPT（GPT-3.5）</p>
<p>早在 2022 年10月，Harrison Chase 发布了基于Python的LangChain。</p>
<p>随后同时包含了Python版和JavaScript（LangChain.js）版的LangChain 也发布了。</p>
<p>2023 年 11 月，Quarkus 发布了 LangChain4j 的 0.1 版本，2025 年 2 月发布了 1.0 - Beta1 版本，4 月发布了 1.0 - Beta3 版本</p>
<p>**官网：**<a target="_blank" rel="noopener" href="https://docs.langchain4j.dev">https://docs.langchain4j.dev</a></p>
<h4 id="1-2、主要功能">1.2、主要功能</h4>
<p><strong>与大型语言模型和向量数据库的便捷交互</strong></p>
<p>通过统一的应用程序编程接口（API），可以轻松访问所有主要的商业和开源大型语言模型以及向量数据库，使你能够构建聊天机器人、智能助手等应用。</p>
<p><strong>专为 Java 打造</strong></p>
<p>借助Spring Boot 集成，能够将大模型集成到ava 应用程序中。大型语言模型与 Java 之间实现了双向集成：你可以从 Java 中调用大型语言模型，同时也允许大型语言模型反过来调用你的 Java 代码</p>
<p><strong>智能代理、工具、检索增强生成（RAG）</strong></p>
<p>为常见的大语言模型操作提供了广泛的工具，涵盖从底层的提示词模板创建、聊天记忆管理和输出解析，到智能代理和检索增强生成等高级模式。</p>
<h4 id="1-3、应用示例">1.3、应用示例</h4>
<ol>
<li>
<p>你想要实现一个自定义的由人工智能驱动的聊天机器人，它可以访问你的数据，并按照你期望的方式运行：</p>
<ul>
<li>
<p>客户支持聊天机器人，它可以：</p>
<ul>
<li>礼貌地回答客户问题</li>
</ul>
</li>
</ul>
</li>
</ol>
<ul>
<li>
<p>处理 / 更改 / 取消订单</p>
</li>
<li>
<p>教育助手，它可以：</p>
<ul>
<li>教授各种学科</li>
</ul>
</li>
<li>
<p>解释不清楚的部分</p>
<ul>
<li>评估用户的理解 / 知识水平</li>
</ul>
</li>
</ul>
<ol start="2">
<li>
<p>你想要处理大量的非结构化数据（文件、网页等），并从中提取结构化信息。例如：</p>
<ul>
<li>从客户评价和支持聊天记录中提取有效评价</li>
<li>从竞争对手的网站上提取有趣的信息</li>
<li>从求职者的简历中提取有效信息</li>
</ul>
</li>
<li>
<p>你想要生成信息，例如：</p>
<ul>
<li>为你的每个客户量身定制的电子邮件</li>
<li>为你的应用程序 / 网站生成内容：
<ul>
<li>博客文章</li>
<li>故事</li>
</ul>
</li>
</ul>
</li>
<li>
<p>你想要转换信息，例如：</p>
<ul>
<li>总结</li>
<li>校对和改写</li>
<li>翻译</li>
</ul>
</li>
</ol>
<h3 id="2、创建SpringBoot项目">2、创建SpringBoot项目</h3>
<h4 id="2-1、创建一个Maven项目">2.1、创建一个Maven项目</h4>
<p>java-ai-langchain4j</p>
<h4 id="2-2、添加SpringBoot相关依赖">2.2、添加SpringBoot相关依赖</h4>
<p>在pom.xml的 <project> 节点下填加如下依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>3.2.6<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">knife4j.version</span>&gt;</span>4.3.0<span class="tag">&lt;/<span class="name">knife4j.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">langchain4j.version</span>&gt;</span>1.0.0-beta3<span class="tag">&lt;/<span class="name">langchain4j.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis-plus.version</span>&gt;</span>3.5.11<span class="tag">&lt;/<span class="name">mybatis-plus.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- web应用程序核心依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 编写和运行测试用例 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 前后端分离中的后端接口测试工具 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-openapi3-jakarta-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;knife4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--引入SpringBoot依赖管理清单--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-3、创建配置文件">2.3、创建配置文件</h4>
<p>在resources下创建配置文件application.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># web服务访问端口</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8080</span></span><br></pre></td></tr></table></figure>
<h4 id="2-4、创建启动类">2.4、创建启动类</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XiaozhiApp</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(XiaozhiApp.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-5、启动启动类">2.5、启动启动类</h4>
<p>访问 <a target="_blank" rel="noopener" href="http://localhost:8080/doc.html">http://localhost:8080/doc.html</a> 查看程序能否成功运行并显示knife4j的界面</p>
<h3 id="3、接入大模型">3、接入大模型</h3>
<ul>
<li><strong>参考文档： Get Started</strong><a target="_blank" rel="noopener" href="https://docs.langchain4j.dev/get-started">https://docs.langchain4j.dev/get-started</a></li>
</ul>
<h4 id="3-1、LangChain4j-库结构">3.1、LangChain4j 库结构</h4>
<p>LangChain4j 具有模块化设计，包括：</p>
<ol>
<li>langchain4j-core 模块，它定义了核心抽象概念（如聊天语言模型和嵌入存储）及其 API。</li>
<li>主 langchain4j 模块，包含有用的工具，如文档加载器、聊天记忆实现，以及诸如人工智能服务等高层功能。</li>
<li>大量的 langchain4j-{集成} 模块，每个模块都将各种大语言模型提供商和嵌入存储集成到 LangChain4j 中。你可以独立使用 langchain4j-{集成} 模块。如需更多功能，只需导入主 langchain4j 依赖项即可。</li>
</ol>
<h4 id="3-2、添加LangChain4j相关依赖">3.2、添加LangChain4j相关依赖</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">langchain4j.version</span>&gt;</span>1.0.0-beta3<span class="tag">&lt;/<span class="name">langchain4j.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 基于open-ai的langchain4j接口：ChatGPT、deepseek都是open-ai标准下的大模型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-open-ai<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--引入langchain4j依赖管理清单--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-bom<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;langchain4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-3、创建测试用例">3.3、创建测试用例</h4>
<p>接入任何一个大模型都需要先去申请apiKey。</p>
<p>如果你暂时没有密钥，也可以使用LangChain4j 提供的演示密钥，这个密钥是免费的，有使用配额限制，且仅限于 gpt-4o-mini 模型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * gpt-4o-mini语言模型接入测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGPTDemo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//初始化模型</span></span><br><span class="line">        <span class="type">OpenAiChatModel</span> <span class="variable">model</span> <span class="operator">=</span> OpenAiChatModel.builder()</span><br><span class="line">                <span class="comment">//LangChain4j提供的代理服务器，该代理服务器会将演示密钥替换成真实密钥， 再将请求转发给OpenAI API</span></span><br><span class="line">                <span class="comment">//.baseUrl(&quot;http://langchain4j.dev/demo/openai/v1&quot;) //设置模型api地址（如果apiKey=&quot;demo&quot;，则可省略baseUrl的配置）</span></span><br><span class="line">                .apiKey(<span class="string">&quot;demo&quot;</span>) <span class="comment">//设置模型apiKey</span></span><br><span class="line">                .modelName(<span class="string">&quot;gpt-4o-mini&quot;</span>) <span class="comment">//设置模型名称</span></span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//向模型提问</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">answer</span> <span class="operator">=</span> model.chat(<span class="string">&quot;你好&quot;</span>);</span><br><span class="line">        <span class="comment">//输出结果</span></span><br><span class="line">        System.out.println(answer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4、SpringBoot整合">4、SpringBoot整合</h3>
<p>**参考文档：**<a target="_blank" rel="noopener" href="https://docs.langchain4j.dev/tutorials/spring-boot-integration">https://docs.langchain4j.dev/tutorials/spring-boot-integration</a></p>
<h4 id="4-1、替换依赖">4.1、替换依赖</h4>
<p>将 <code>langchain4j-open-ai</code> 替换成 <code>langchain4j-open-ai-spring-boot-starter</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-open-ai-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-2、配置模型参数">4.2、配置模型参数</h4>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#langchain4j测试模型</span></span><br><span class="line"><span class="attr">langchain4j.open-ai.chat-model.api-key</span>=<span class="string">demo</span></span><br><span class="line"><span class="attr">langchain4j.open-ai.chat-model.model-name</span>=<span class="string">gpt-4o</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#请求和响应日志</span></span><br><span class="line"><span class="attr">langchain4j.open-ai.chat-model.log-requests</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">langchain4j.open-ai.chat-model.log-responses</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#启用日志debug级别</span></span><br><span class="line"><span class="attr">logging.level.root</span>=<span class="string">debug</span></span><br></pre></td></tr></table></figure>
<h4 id="4-3、创建测试用例">4.3、创建测试用例</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 整合SpringBoot</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> OpenAiChatModel openAiChatModel;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSpringBoot</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//向模型提问</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">answer</span> <span class="operator">=</span> openAiChatModel.chat(<span class="string">&quot;你好&quot;</span>);</span><br><span class="line">    <span class="comment">//输出结果</span></span><br><span class="line">    System.out.println(answer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="二、接入其他大模型">二、接入其他大模型</h2>
<h3 id="1、都有哪些大模型">1、都有哪些大模型</h3>
<ul>
<li>**大语言模型排行榜：**<a target="_blank" rel="noopener" href="https://superclueai.com/">https://superclueai.com/</a></li>
</ul>
<p>SuperCLUE 是由国内 CLUE 学术社区于 2023 年 5 月推出的中文通用大模型综合性评测基准。</p>
<ul>
<li>
<p><strong>评测目的</strong>：全面评估中文大模型在语义理解、逻辑推理、代码生成等 10 项基础能力，以及涵盖数学、物理、社科等 50 多学科的专业能力，旨在回答在通用大模型发展背景下，中文大模型的效果情况，包括不同任务效果、与国际代表性模型的差距、与人类的效果对比等问题。</p>
</li>
<li>
<p><strong>特色优势</strong>：针对中文特性任务，如成语、诗歌、字形等设立专项评测，使评测更符合中文语言特点。通过 3700 多道客观题和匿名对战机制，动态追踪国内外主流模型，如 GPT-4、文心一言、通义千问等的表现差异，保证评测的客观性和时效性。</p>
</li>
<li>
<p><strong>行业影响</strong>：作为中文领域权威测评社区，其评测结果被学界和产业界广泛引用，例如商汤 “日日新 5.0” 和百度文心大模型均通过 SuperCLUE 验证技术突破，推动了中文 NLP 技术生态的迭代，为中文大模型的发展和优化提供了重要的参考依据，促进了中文大模型技术的不断进步和应用。</p>
</li>
<li>
<p><strong>LangChain4j支持接入的大模型</strong>：<a target="_blank" rel="noopener" href="https://docs.langchain4j.dev/integrations/language-models/">https://docs.langchain4j.dev/integrations/language-models/</a></p>
</li>
</ul>
<h3 id="2、接入DeepSeek">2、接入DeepSeek</h3>
<h4 id="1-1、获取开发参数">1.1、获取开发参数</h4>
<ul>
<li>**访问官网：**<a target="_blank" rel="noopener" href="https://www.deepseek.com/">https://www.deepseek.com/</a>  注册账号，获取base_url和api_key，充值</li>
</ul>
<h4 id="1-2、配置开发参数">1.2、配置开发参数</h4>
<p>为了apikay的安全，建议将其配置在服务器的环境变量中。变量名自定义即可，例如 <code>DEEP_SEEK_API_KEY</code></p>
<h4 id="1-3、配置模型参数">1.3、配置模型参数</h4>
<p>**DeepSeek API文档：**<a target="_blank" rel="noopener" href="https://api-docs.deepseek.com/zh-cn/">https://api-docs.deepseek.com/zh-cn/</a></p>
<p>在 LangChain4j 中，DeepSeek 和 GPT 一样也使用了 OpenAI 的接口标准，因此也使用OpenAiChatModel进行接入</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#DeepSeek</span></span><br><span class="line"><span class="attr">langchain4j.open-ai.chat-model.base-url</span>=<span class="string">https://api.deepseek.com</span></span><br><span class="line"><span class="attr">langchain4j.open-ai.chat-model.api-key</span>=<span class="string">$&#123;DEEP_SEEK_API_KEY&#125;</span></span><br><span class="line"><span class="comment">#DeepSeek-V3</span></span><br><span class="line"><span class="attr">langchain4j.open-ai.chat-model.model-name</span>=<span class="string">deepseek-chat</span></span><br><span class="line"><span class="comment">#DeepSeek-R1 推理模型</span></span><br><span class="line"><span class="comment">#langchain4j.open-ai.chat-model.model-name=deepseek-reasoner</span></span><br></pre></td></tr></table></figure>
<h4 id="1-4、测试">1.4、测试</h4>
<p>直接使用前面的测试用例即可</p>
<p>配置好后记得在idea下方的终端进行验证：echo %DEEP_SEEK_API_KEY%</p>
<h3 id="3、ollama本地部署">3、ollama本地部署</h3>
<h4 id="3-1、为什么要本地部署">3.1、为什么要本地部署</h4>
<p>Ollama 是一个本地部署大模型的工具。使用 Ollama 进行本地部署有以下多方面的原因：</p>
<ul>
<li>数据隐私与安全：对于金融、医疗、法律等涉及大量敏感数据的行业，数据安全至关重要。</li>
<li>离线可用性：在网络不稳定或无法联网的环境中，本地部署的 Ollama 模型仍可正常运行。</li>
<li>降低成本：云服务通常按使用量收费，长期使用下来费用较高。而 Ollama 本地部署，只需一次性投入硬件成本，对于需要频繁使用大语言模型且对成本敏感的用户或企业来说，能有效节约成本。</li>
<li>部署流程简单：只需通过简单的命令 “ollama run &lt; 模型名&gt;”，就可以自动下载并运行所需的模型。</li>
<li>灵活扩展与定制：可对模型微调，以适配垂直领域需求。</li>
</ul>
<h4 id="3-2、在ollama上部署DeepSeek">3.2、在ollama上部署DeepSeek</h4>
<p>**官网：**<a target="_blank" rel="noopener" href="https://ollama.com/">https://ollama.com/</a></p>
<p>（1）下载并安装ollama：<code>OllamaSetup.exe</code></p>
<p>（2）查看模型列表，选择要部署的模型，<strong>模型列表：</strong> <a target="_blank" rel="noopener" href="https://ollama.com/search">https://ollama.com/search</a></p>
<p>（3）执行命令：<code>ollama run deepseek-r1:1.5</code>运行大模型。如果是第一次运行则会先下载大模型</p>
<h4 id="3-3、常用命令">3.3、常用命令</h4>
<h4 id="3-4、引入依赖">3.4、引入依赖</h4>
<p>**参考文档：**<a target="_blank" rel="noopener" href="https://docs.langchain4j.dev/integrations/language-models/ollama#get-started">https://docs.langchain4j.dev/integrations/language-models/ollama#get-started</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 接入ollama --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-ollama-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-5、配置模型参数">3.5、配置模型参数</h4>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ollama</span></span><br><span class="line"><span class="attr">langchain4j.ollama.chat-model.base-url</span>=<span class="string">http://localhost:11434</span></span><br><span class="line"><span class="attr">langchain4j.ollama.chat-model.model-name</span>=<span class="string">deepseek-r1:1.5b</span></span><br><span class="line"><span class="attr">langchain4j.ollama.chat-model.log-requests</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">langchain4j.ollama.chat-model.log-responses</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>
<h4 id="3-6、创建测试用例">3.6、创建测试用例</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ollama接入</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> OllamaChatModel ollamaChatModel;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testOllama</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//向模型提问</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">answer</span> <span class="operator">=</span> ollamaChatModel.chat(<span class="string">&quot;你好&quot;</span>);</span><br><span class="line">    <span class="comment">//输出结果</span></span><br><span class="line">    System.out.println(answer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4、接入阿里百炼平台">4、接入阿里百炼平台</h3>
<h4 id="4-1、什么是阿里百炼">4.1、什么是阿里百炼</h4>
<ul>
<li>
<p>阿里云百炼是 2023 年 10 月推出的。它集成了阿里的通义系列大模型和第三方大模型，涵盖文本、图像、音视频等不同模态。</p>
</li>
<li>
<p><strong>功能优势</strong>：集成超百款大模型 API，模型选择丰富；5-10 分钟就能低代码快速构建智能体，应用构建高效；提供全链路模型训练、评估工具及全套应用开发工具，模型服务多元；在线部署可按需扩缩容，新用户有千万 token 免费送，业务落地成本低。</p>
</li>
<li>
<p>**支持接入的模型列表：**<a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/model-studio/models">https://help.aliyun.com/zh/model-studio/models</a></p>
</li>
<li>
<p>**模型广场：**<a target="_blank" rel="noopener" href="https://bailian.console.aliyun.com/?productCode=p_efm#/model-market">https://bailian.console.aliyun.com/?productCode=p_efm#/model-market</a></p>
</li>
</ul>
<h4 id="4-2、申请免费体验">4.2、申请免费体验</h4>
<p>（1）点击进入免费体验页面</p>
<p>（2）点击免费体验</p>
<p>（3）点击开通服务</p>
<p>（4）确认开通</p>
<h4 id="4-3、配置apiKey">4.3、配置apiKey</h4>
<p>**申请apiKey：**<a target="_blank" rel="noopener" href="https://bailian.console.aliyun.com/?apiKey=1&amp;productCode=p_efm#/api-key">https://bailian.console.aliyun.com/?apiKey=1&amp;productCode=p_efm#/api-key</a></p>
<p><strong>配置apiKey：<strong>配置在环境变量</strong>DASH_SCOPE_API_KEY</strong>中</p>
<h4 id="4-4、添加依赖">4.4、添加依赖</h4>
<p>**LangChain4j参考文档：**<a target="_blank" rel="noopener" href="https://docs.langchain4j.dev/integrations/language-models/dashscope#plain-java">https://docs.langchain4j.dev/integrations/language-models/dashscope#plain-java</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 接入阿里云百炼平台 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-community-dashscope-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--引入百炼依赖管理清单--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-community-bom<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;langchain4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-5、配置模型参数">4.5、配置模型参数</h4>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#阿里百炼平台</span></span><br><span class="line"><span class="attr">langchain4j.community.dashscope.chat-model.api-key</span>=<span class="string">$&#123;DASH_SCOPE_API_KEY&#125;</span></span><br><span class="line"><span class="attr">langchain4j.community.dashscope.chat-model.model-name</span>=<span class="string">qwen-max</span></span><br></pre></td></tr></table></figure>
<h4 id="4-6、测试通义千问">4.6、测试通义千问</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通义千问大模型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> QwenChatModel qwenChatModel;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDashScopeQwen</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//向模型提问</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">answer</span> <span class="operator">=</span> qwenChatModel.chat(<span class="string">&quot;你好&quot;</span>);</span><br><span class="line">    <span class="comment">//输出结果</span></span><br><span class="line">    System.out.println(answer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-6、测试通义万象">4.6、测试通义万象</h4>
<p>生成图片测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDashScopeWanx</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">WanxImageModel</span> <span class="variable">wanxImageModel</span> <span class="operator">=</span> WanxImageModel.builder()</span><br><span class="line">            .modelName(<span class="string">&quot;wanx2.1-t2i-plus&quot;</span>)</span><br><span class="line">            .apiKey(System.getenv(<span class="string">&quot;DASH_SCOPE_API_KEY&quot;</span>))</span><br><span class="line">            .build();</span><br><span class="line">    Response&lt;Image&gt; response = wanxImageModel.generate(<span class="string">&quot;奇幻森林精灵：在一片弥漫着轻柔薄雾的古老森林深处，阳光透过茂密枝叶洒下金色光斑。一位身材娇小、长着透明薄翼的精灵少女站在一朵硕大的蘑菇上。她有着海藻般的绿色长发，发间点缀着蓝色的小花，皮肤泛着珍珠般的微光。身上穿着由翠绿树叶和白色藤蔓编织而成的连衣裙，手中捧着一颗散发着柔和光芒的水晶球，周围环绕着五彩斑斓的蝴蝶，脚下是铺满苔藓的地面，蘑菇和蕨类植物丛生，营造出神秘而梦幻的氛围。&quot;</span>);</span><br><span class="line">    System.out.println(response.content().url());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-7、测试DeepSeek">4.7、测试DeepSeek</h4>
<p>也可以在阿里百炼上集成第三方大模型，如DeepSeek</p>
<p>将配置参数上的base-url参数指定到百炼平台，使用百炼上的大模型名称和apiKey即可</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#集成百炼-deepseek</span></span><br><span class="line"><span class="attr">langchain4j.open-ai.chat-model.base-url</span>=<span class="string">https://dashscope.aliyuncs.com/compatible-mode/v1</span></span><br><span class="line"><span class="attr">langchain4j.open-ai.chat-model.api-key</span>=<span class="string">$&#123;DASH_SCOPE_API_KEY&#125;</span></span><br><span class="line"><span class="attr">langchain4j.open-ai.chat-model.model-name</span>=<span class="string">deepseek-v3</span></span><br><span class="line"><span class="comment">#温度系数：取值范围通常在 0 到 1 之间。值越高，模型的输出越随机、富有创造性；</span></span><br><span class="line"><span class="comment"># 值越低，输出越确定、保守。这里设置为 0.9，意味着模型会有一定的随机性，生成的回复可能会比较多样化。</span></span><br><span class="line"><span class="attr">langchain4j.open-ai.chat-model.temperature</span>=<span class="string">0.9</span></span><br></pre></td></tr></table></figure>
<p>使用之前的测试用例<code>testSpringBoot</code>测试即可</p>
<h2 id="三、人工智能服务-AIService">三、人工智能服务 AIService</h2>
<h3 id="1、什么是AIService">1、什么是AIService</h3>
<p>AIService使用面向接口和动态代理的方式完成程序的编写，更灵活的实现高级功能。</p>
<h4 id="1-1、链-Chain（旧版）">1.1、链 Chain（旧版）</h4>
<p>链的概念源自 Python 中的 LangChain。其理念是针对每个常见的用例都设置一条链，比如聊天机器人、检索增强生成（RAG）等。链将多个底层组件组合起来，并协调它们之间的交互。链存在的主要问题是不灵活，我们不进行深入的研究。</p>
<h4 id="1-2、人工智能服务-AIService">1.2、人工智能服务 AIService</h4>
<p>在LangChain4j中我们使用AIService完成复杂操作。底层组件将由AIService进行组装。</p>
<p><strong>AIService可处理最常见的操作：</strong></p>
<ul>
<li>为大语言模型格式化输入内容</li>
<li>解析大语言模型的输出结果</li>
</ul>
<p><strong>它们还支持更高级的功能：</strong></p>
<ul>
<li>聊天记忆 Chat memory</li>
<li>工具 Tools</li>
<li>检索增强生成 RAG</li>
</ul>
<h3 id="2、创建AIService">2、创建AIService</h3>
<h4 id="2-1、引入依赖">2.1、引入依赖</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--langchain4j高级功能--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-2、创建接口">2.2、创建接口</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Assistant</span> &#123;</span><br><span class="line">    String <span class="title function_">chat</span><span class="params">(String userMessage)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3、测试用例">2.3、测试用例</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AIServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> QwenChatModel qwenChatModel;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testChat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//创建AIService</span></span><br><span class="line">        <span class="type">Assistant</span> <span class="variable">assistant</span> <span class="operator">=</span> AiServices.create(Assistant.class, qwenChatModel);</span><br><span class="line">        <span class="comment">//调用service的接口</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">answer</span> <span class="operator">=</span> assistant.chat(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">        System.out.println(answer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-4、-AiService">2.4、@AiService</h4>
<p>也可以在<code>Assistant</code>接口上添加<code>@AiService</code>注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//因为我们在配置文件中同时配置了多个大语言模型，所以需要在这里明确指定（EXPLICIT）模型的beanName（qwenChatModel）</span></span><br><span class="line"><span class="meta">@AiService(wiringMode = EXPLICIT, chatModel = &quot;qwenChatModel&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Assistant</span> &#123;</span><br><span class="line">    String <span class="title function_">chat</span><span class="params">(String userMessage)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试用例中，我们可以直接注入Assistant对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Assistant assistant;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAssistant</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">answer</span> <span class="operator">=</span> assistant.chat(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">    System.out.println(answer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-5、工作原理">2.5、工作原理</h4>
<p>AiServices会<strong>组装Assistant接口以及其他组件</strong>，并使用反射机制创建一个实现Assistant接口的<strong>代理对象</strong>。这个代理对象会处理输入和输出的所有转换工作。在这个例子中，chat方法的输入是一个字符串，但是大模型需要一个<code>UserMessage</code>对象。所以，代理对象将这个字符串转换为<code>UserMessage</code>，并调用聊天语言模型。chat方法的输出类型也是字符串，但是大模型返回的是 <code>AiMessage</code> 对象，代理对象会将其转换为字符串。</p>
<p><strong>简单理解就是：代理对象的作用是输入转换和输出转换</strong></p>
<h2 id="四、聊天记忆-Chat-memory">四、聊天记忆 Chat memory</h2>
<h3 id="1、测试对话是否有记忆">1、测试对话是否有记忆</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatMemoryTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Assistant assistant;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testChatMemory</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">answer1</span> <span class="operator">=</span> assistant.chat(<span class="string">&quot;我是环环&quot;</span>);</span><br><span class="line">        System.out.println(answer1);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">answer2</span> <span class="operator">=</span> assistant.chat(<span class="string">&quot;我是谁&quot;</span>);</span><br><span class="line">        System.out.println(answer2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很显然，目前的接入方式，大模型是没有记忆的。API级别是不行的</p>
<h3 id="2、聊天记忆的简单实现">2、聊天记忆的简单实现</h3>
<p>可以使用下面的方式实现对话记忆。[其实就是把上次问的和回答的都一起发送给一轮对话来达到记忆的效果]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> QwenChatModel qwenChatModel;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testChatMemory2</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第一轮对话</span></span><br><span class="line">    <span class="type">UserMessage</span> <span class="variable">userMessage1</span> <span class="operator">=</span> UserMessage.userMessage(<span class="string">&quot;我是环环&quot;</span>);</span><br><span class="line">    <span class="type">ChatResponse</span> <span class="variable">chatResponse1</span> <span class="operator">=</span> qwenChatModel.chat(userMessage1);</span><br><span class="line">    <span class="type">AiMessage</span> <span class="variable">aiMessage1</span> <span class="operator">=</span> chatResponse1.aiMessage();</span><br><span class="line">    <span class="comment">//输出大语言模型的回复</span></span><br><span class="line">    System.out.println(aiMessage1.text());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第二轮对话</span></span><br><span class="line">    <span class="type">UserMessage</span> <span class="variable">userMessage2</span> <span class="operator">=</span> UserMessage.userMessage(<span class="string">&quot;你知道我是谁吗&quot;</span>);</span><br><span class="line">    <span class="type">ChatResponse</span> <span class="variable">chatResponse2</span> <span class="operator">=</span> qwenChatModel.chat(Arrays.asList(userMessage1, aiMessage1, userMessage2));</span><br><span class="line">    <span class="type">AiMessage</span> <span class="variable">aiMessage2</span> <span class="operator">=</span> chatResponse2.aiMessage();</span><br><span class="line">    <span class="comment">//输出大语言模型的回复</span></span><br><span class="line">    System.out.println(aiMessage2.text());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3、使用ChatMemory实现聊天记忆">3、使用ChatMemory实现聊天记忆</h3>
<p>使用AIService可以封装多轮对话的复杂性，使聊天记忆功能的实现变得简单</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testChatMemory3</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建chatMemory</span></span><br><span class="line">    <span class="type">MessageWindowChatMemory</span> <span class="variable">chatMemory</span> <span class="operator">=</span> MessageWindowChatMemory.withMaxMessages(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建AIService</span></span><br><span class="line">    <span class="type">Assistant</span> <span class="variable">assistant</span> <span class="operator">=</span> AiServices</span><br><span class="line">            .builder(Assistant.class)</span><br><span class="line">            .chatLanguageModel(qwenChatModel)</span><br><span class="line">            .chatMemory(chatMemory)</span><br><span class="line">            .build();</span><br><span class="line">    <span class="comment">//调用service的接口</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">answer1</span> <span class="operator">=</span> assistant.chat(<span class="string">&quot;我是环环&quot;</span>);</span><br><span class="line">    System.out.println(answer1);</span><br><span class="line">    <span class="type">String</span> <span class="variable">answer2</span> <span class="operator">=</span> assistant.chat(<span class="string">&quot;我是谁&quot;</span>);</span><br><span class="line">    System.out.println(answer2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4、使用AIService实现聊天记忆">4、使用AIService实现聊天记忆</h3>
<h4 id="4-1、创建记忆对话智能体">4.1、创建记忆对话智能体</h4>
<p>当AIService由多个组件（大模型，聊天记忆，等）组成的时候，我们就可以称他为<code>智能体</code>了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.assistant;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AiService(</span></span><br><span class="line"><span class="meta">    wiringMode = EXPLICIT,</span></span><br><span class="line"><span class="meta">    chatModel = &quot;qwenChatModel&quot;,</span></span><br><span class="line"><span class="meta">    chatMemory = &quot;chatMemory&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MemoryChatAssistant</span> &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">chat</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-2、配置ChatMemory">4.2、配置ChatMemory</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.config;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemoryChatAssistantConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    ChatMemory <span class="title function_">chatMemory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//设置聊天记忆记录的message数量</span></span><br><span class="line">        <span class="keyword">return</span> MessageWindowChatMemory.withMaxMessages(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="4-3、测试">4.3、测试</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> MemoryChatAssistant memoryChatAssistant;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testChatMemory4</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">answer1</span> <span class="operator">=</span> memoryChatAssistant.chat(<span class="string">&quot;我是环环&quot;</span>);</span><br><span class="line">    System.out.println(answer1);</span><br><span class="line">    <span class="type">String</span> <span class="variable">answer2</span> <span class="operator">=</span> memoryChatAssistant.chat(<span class="string">&quot;我是谁&quot;</span>);</span><br><span class="line">    System.out.println(answer2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5、隔离聊天记忆">5、隔离聊天记忆</h3>
<p>为每个用户的新聊天或者不同的用户区分聊天记忆</p>
<h4 id="5-1、创建记忆隔离对话智能体">5.1、创建记忆隔离对话智能体</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.assistant;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AiService(</span></span><br><span class="line"><span class="meta">    wiringMode = EXPLICIT, </span></span><br><span class="line"><span class="meta">    chatMemory = &quot;chatMemory&quot;,</span></span><br><span class="line"><span class="meta">    chatMemoryProvider = &quot;chatMemoryProvider&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SeparateChatAssistant</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分离聊天记录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> memoryId 聊天id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userMessage 用户消息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">chat</span><span class="params">(<span class="meta">@MemoryId</span> <span class="type">int</span> memoryId, <span class="meta">@UserMessage</span> String userMessage)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-2、配置ChatMemoryProvider">5.2、配置ChatMemoryProvider</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.config;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SeparateChatAssistantConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    ChatMemoryProvider <span class="title function_">chatMemoryProvider</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> memoryId -&gt; MessageWindowChatMemory.builder()</span><br><span class="line">                .id(memoryId)</span><br><span class="line">            	.maxMessages(<span class="number">10</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="5-3、测试对话助手">5.3、测试对话助手</h4>
<p>用两个不同的memoryId测试聊天记忆的隔离效果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SeparateChatAssistant separateChatAssistant;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testChatMemory5</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">answer1</span> <span class="operator">=</span> separateChatAssistant.chat(<span class="number">1</span>,<span class="string">&quot;我是环环&quot;</span>);</span><br><span class="line">    System.out.println(answer1);</span><br><span class="line">    <span class="type">String</span> <span class="variable">answer2</span> <span class="operator">=</span> separateChatAssistant.chat(<span class="number">1</span>,<span class="string">&quot;我是谁&quot;</span>);</span><br><span class="line">    System.out.println(answer2);</span><br><span class="line">    <span class="type">String</span> <span class="variable">answer3</span> <span class="operator">=</span> separateChatAssistant.chat(<span class="number">2</span>,<span class="string">&quot;我是谁&quot;</span>);</span><br><span class="line">    System.out.println(answer3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="五、持久化聊天记忆-Persistence">五、持久化聊天记忆 Persistence</h2>
<p>默认情况下，聊天记忆存储在内存中。如果需要持久化存储，可以实现一个自定义的聊天记忆存储类，以便将聊天消息存储在你选择的任何持久化存储介质中。</p>
<h3 id="1、存储介质的选择">1、存储介质的选择</h3>
<p>大模型中聊天记忆的存储选择哪种数据库，需要综合考虑数据特点、应用场景和性能要求等因素，以下是一些常见的选择及其特点：</p>
<ul>
<li>
<p>MySQL</p>
<ul>
<li>
<p><strong>特点</strong>：关系型数据库。支持事务处理，确保数据的一致性和完整性，适用于结构化数据的存储和查询。</p>
</li>
<li>
<p><strong>适用场景</strong>：如果聊天记忆数据结构较为规整，例如包含固定的字段如对话 ID、用户 ID、时间戳、消息内容等，且需要进行复杂的查询和统计分析，如按用户统计对话次数、按时间范围查询特定对话等，MySQL 是不错的选择。</p>
</li>
</ul>
</li>
<li>
<p>Redis</p>
<ul>
<li>
<p><strong>特点</strong>：内存数据库，读写速度极高。它适用于存储热点数据，并且支持多种数据结构，如字符串、哈希表、列表等，方便对不同类型的聊天记忆数据进行处理。</p>
</li>
<li>
<p><strong>适用场景</strong>：对于实时性要求极高的聊天应用，如在线客服系统或即时通讯工具，Redis 可以快速存储和获取最新的聊天记录，以提供流畅的聊天体验。</p>
</li>
</ul>
</li>
<li>
<p>MongoDB</p>
<ul>
<li>
<p><strong>特点</strong>：文档型数据库，数据以 JSON - like 的文档形式存储，具有高度的灵活性和可扩展性。它不需要预先定义严格的表结构，适合存储半结构化或非结构化的数据。</p>
</li>
<li>
<p><strong>适用场景</strong>：当聊天记忆中包含多样化的信息，如文本消息、图片、语音等多媒体数据，或者消息格式可能会频繁变化时，MongoDB 能很好地适应这种灵活性。例如，一些社交应用中用户可能会发送各种格式的消息，使用 MongoDB 可以方便地存储和管理这些不同类型的数据。</p>
</li>
</ul>
</li>
<li>
<p>Cassandra</p>
<ul>
<li>
<p><strong>特点</strong>：是一种分布式的 NoSQL 数据库，具有高可扩展性和高可用性，能够处理大规模的分布式数据存储和读写请求。适合存储海量的、时间序列相关的数据。</p>
</li>
<li>
<p><strong>适用场景</strong>：对于大型的聊天应用，尤其是用户量众多、聊天数据量巨大且需要分布式存储和处理的场景，Cassandra 能够有效地应对高并发的读写操作。例如，一些面向全球用户的社交媒体平台，其聊天数据需要在多个节点上进行分布式存储和管理，Cassandra 可以提供强大的支持。</p>
</li>
</ul>
</li>
</ul>
<h3 id="2、MongoDB">2、MongoDB</h3>
<h4 id="2-1、简介">2.1、简介</h4>
<p>MongoDB 是一个基于文档的 NoSQL 数据库，由 MongoDB Inc. 开发。</p>
<p>NoSQL，指的是非关系型的数据库。NoSQL有时也称作Not Only SQL的缩写，是对不同于传统的关系型数据库的数据库管理系统的统称。</p>
<p>MongoDB 的设计理念是为了应对大数据量、高性能和灵活性需求。</p>
<p>MongoDB使用集合（Collections）来组织文档（Documents），每个文档都是由键值对组成的。</p>
<ul>
<li><strong>数据库（Database）</strong>：存储数据的容器，类似于关系型数据库中的数据库。</li>
<li><strong>集合（Collection）</strong>：数据库中的一个集合，类似于关系型数据库中的表。</li>
<li><strong>文档（Document）</strong>：集合中的一个数据记录，类似于关系型数据库中的行（row），以 BSON 格式存储。</li>
</ul>
<p>MongoDB 将数据存储为一个文档，数据结构由键值(key=&gt;value)对组成，文档类似于 JSON 对象，字段值可以包含其他文档，数组及文档数组</p>
<h4 id="2-2、安装MongoDB">2.2、安装MongoDB</h4>
<p>服务器：<code>mongodb-windows-x86_64-8.0.6-signed.msi </code><a target="_blank" rel="noopener" href="https://www.mongodb.com/try/download/community">https://www.mongodb.com/try/download/community</a></p>
<p>命令行客户端 ：<code>mongosh-2.5.0-win32-x64.zip</code> <a target="_blank" rel="noopener" href="https://www.mongodb.com/try/download/shell">https://www.mongodb.com/try/download/shell</a></p>
<p>图形客户端：<code>mongodb-compass-1.39.3-win32-x64.exe</code> <a target="_blank" rel="noopener" href="https://www.mongodb.com/try/download/compass">https://www.mongodb.com/try/download/compass</a></p>
<h4 id="2-3、使用mongosh">2.3、使用mongosh</h4>
<p><strong>启动 MongoDB Shell：</strong></p>
<p>在命令行中输入 mongosh 命令，启动 MongoDB Shell，如果 MongoDB 服务器运行在本地默认端口（27017），则可以直接连接。</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mongosh</span></span><br></pre></td></tr></table></figure>
<p><strong>连接到 MongoDB 服务器：</strong></p>
<p>如果 MongoDB 服务器运行在非默认端口或者远程服务器上，可以使用以下命令连接：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongosh --host &lt;hostname&gt;<span class="symbol">:&lt;port&gt;</span></span><br></pre></td></tr></table></figure>
<p>其中 <code>&lt;hostname&gt;</code> 是 MongoDB 服务器的主机名或 IP 地址，<code>&lt;port&gt;</code> 是 MongoDB 服务器的端口号。</p>
<p><strong>执行基本操作：</strong></p>
<p>连接成功后，可以执行各种 MongoDB 数据库操作。例如：</p>
<ul>
<li>查看当前数据库：<code>db</code></li>
<li>显示数据库列表：<code>show dbs</code></li>
<li>切换到指定数据库：<code>use &lt;database_name&gt;</code></li>
<li>执行查询操作：<code>db.&lt;collection_name&gt;.find()</code></li>
<li>插入文档：<code>db.&lt;collection_name&gt;.insertOne(&#123; ... &#125;)</code></li>
<li>更新文档：<code>db.&lt;collection_name&gt;.updateOne(&#123; ... &#125;)</code></li>
<li>删除文档：<code>db.&lt;collection_name&gt;.deleteOne(&#123; ... &#125;)</code></li>
<li>退出 MongoDB Shell：<code>quit()</code> 或者 <code>exit</code></li>
</ul>
<p><strong>CRUD</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">插入文档</span></span><br><span class="line"><span class="meta prompt_">test&gt; </span><span class="language-bash">db.mycollection.insertOne(&#123; name: <span class="string">&quot;Alice&quot;</span>, age: 30 &#125;)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询文档</span></span><br><span class="line"><span class="meta prompt_">test&gt; </span><span class="language-bash">db.mycollection.find()</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新文档</span></span><br><span class="line"><span class="meta prompt_">test&gt; </span><span class="language-bash">db.mycollection.updateOne(&#123; name: <span class="string">&quot;Alice&quot;</span> &#125;, &#123; <span class="variable">$set</span>: &#123; age: 31 &#125; &#125;)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除文档</span></span><br><span class="line"><span class="meta prompt_">test&gt; </span><span class="language-bash">db.mycollection.deleteOne(&#123; name: <span class="string">&quot;Alice&quot;</span> &#125;)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">退出 MongoDB Shell</span></span><br><span class="line"><span class="meta prompt_">test&gt; </span><span class="language-bash">quit()</span></span><br></pre></td></tr></table></figure>
<h4 id="2-4、使用mongodb-compass">2.4、使用mongodb-compass</h4>
<h4 id="2-5、整合SpringBoot">2.5、整合SpringBoot</h4>
<p>引入MongoDB依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Spring Boot Starter Data MongoDB --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>添加远程连接配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#MongoDB连接配置</span></span><br><span class="line"><span class="attr">spring.data.mongodb.uri</span>=<span class="string">mongodb://localhost:27017/chat_memory_db</span></span><br></pre></td></tr></table></figure>
<h4 id="2-6、CRUD测试">2.6、CRUD测试</h4>
<p>创建实体类：映射MongoDB中的文档（相当与MySQL的表）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.bean;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Document(&quot;chat_messages&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatMessages</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//唯一标识，映射到 MongoDB 文档的 _id 字段</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> ObjectId messageId;</span><br><span class="line">    <span class="comment">//private Long messageId;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String content; <span class="comment">//存储当前聊天记录列表的json字符串</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建测试类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MongoCrudTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入文档</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="comment">/* @Test</span></span><br><span class="line"><span class="comment">    public void testInsert() &#123;</span></span><br><span class="line"><span class="comment">        mongoTemplate.insert(new ChatMessages(1L, &quot;聊天记录&quot;));</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入文档</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsert2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ChatMessages</span> <span class="variable">chatMessages</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChatMessages</span>();</span><br><span class="line">        chatMessages.setContent(<span class="string">&quot;聊天记录列表&quot;</span>);</span><br><span class="line">        mongoTemplate.insert(chatMessages);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询文档</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindById</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ChatMessages</span> <span class="variable">chatMessages</span> <span class="operator">=</span> mongoTemplate.findById(<span class="string">&quot;6801ead733ba9c4a0d9b6c7b&quot;</span>, ChatMessages.class);</span><br><span class="line">        System.out.println(chatMessages);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改文档</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> Criteria.where(<span class="string">&quot;_id&quot;</span>).is(<span class="string">&quot;6801ead733ba9c4a0d9b6c7b&quot;</span>);</span><br><span class="line">        <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Query</span>(criteria);</span><br><span class="line">        <span class="type">Update</span> <span class="variable">update</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Update</span>();</span><br><span class="line">        update.set(<span class="string">&quot;content&quot;</span>, <span class="string">&quot;新的聊天记录列表&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//修改或新增</span></span><br><span class="line">        mongoTemplate.upsert(query, update, ChatMessages.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增或修改文档</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate2</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> Criteria.where(<span class="string">&quot;_id&quot;</span>).is(<span class="string">&quot;100&quot;</span>);</span><br><span class="line">        <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Query</span>(criteria);</span><br><span class="line">        <span class="type">Update</span> <span class="variable">update</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Update</span>();</span><br><span class="line">        update.set(<span class="string">&quot;content&quot;</span>, <span class="string">&quot;新的聊天记录列表&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//修改或新增</span></span><br><span class="line">        mongoTemplate.upsert(query, update, ChatMessages.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除文档</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> Criteria.where(<span class="string">&quot;_id&quot;</span>).is(<span class="string">&quot;100&quot;</span>);</span><br><span class="line">        <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Query</span>(criteria);</span><br><span class="line">        mongoTemplate.remove(query, ChatMessages.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3、持久化聊天">3、持久化聊天</h3>
<h4 id="3-1、优化实体类">3.1、优化实体类</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.bean;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Document(&quot;chat_messages&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatMessages</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//唯一标识，映射到 MongoDB 文档的 _id 字段</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> ObjectId id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> messageId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String content; <span class="comment">//存储当前聊天记录列表的json字符串</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-2、创建持久化类">3.2、创建持久化类</h4>
<p>创建一个类实现ChatMemoryStore接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.store;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MongoChatMemoryStore</span> <span class="keyword">implements</span> <span class="title class_">ChatMemoryStore</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;ChatMessage&gt; <span class="title function_">getMessages</span><span class="params">(Object memoryId)</span> &#123;</span><br><span class="line">        <span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> Criteria.where(<span class="string">&quot;memoryId&quot;</span>).is(memoryId);</span><br><span class="line">        <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Query</span>(criteria);</span><br><span class="line">        <span class="type">ChatMessages</span> <span class="variable">chatMessages</span> <span class="operator">=</span> mongoTemplate.findOne(query, ChatMessages.class);</span><br><span class="line">        <span class="keyword">if</span>(chatMessages == <span class="literal">null</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">return</span> ChatMessageDeserializer.messagesFromJson(chatMessages.getContent());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateMessages</span><span class="params">(Object memoryId, List&lt;ChatMessage&gt; messages)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> Criteria.where(<span class="string">&quot;memoryId&quot;</span>).is(memoryId);</span><br><span class="line">        <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Query</span>(criteria);</span><br><span class="line"></span><br><span class="line">        <span class="type">Update</span> <span class="variable">update</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Update</span>();</span><br><span class="line">        update.set(<span class="string">&quot;content&quot;</span>, ChatMessageSerializer.messagesToJson(messages));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据query条件能查询出文档，则修改文档；否则新增文档</span></span><br><span class="line">        mongoTemplate.upsert(query, update, ChatMessages.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteMessages</span><span class="params">(Object memoryId)</span> &#123;</span><br><span class="line">        <span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> Criteria.where(<span class="string">&quot;memoryId&quot;</span>).is(memoryId);</span><br><span class="line">        <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Query</span>(criteria);</span><br><span class="line">        mongoTemplate.remove(query, ChatMessages.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在SeparateChatAssistantConfig中，添加MongoChatMemoryStore对象的配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.config;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SeparateChatAssistantConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注入持久化对象</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MongoChatMemoryStore mongoChatMemoryStore;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    ChatMemoryProvider <span class="title function_">chatMemoryProvider</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> memoryId -&gt; MessageWindowChatMemory.builder()</span><br><span class="line">                .id(memoryId)</span><br><span class="line">                .maxMessages(<span class="number">10</span>)</span><br><span class="line">                .chatMemoryStore(mongoChatMemoryStore)<span class="comment">//配置持久化对象</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4、测试">4、测试</h3>
<p>发现MongoDB中已经存储了会话记录</p>
<h2 id="六、提示词-Prompt">六、提示词 Prompt</h2>
<h3 id="1、系统提示词">1、系统提示词</h3>
<p><strong>@SystemMessage</strong> 设定角色，塑造AI助手的专业身份，明确助手的能力范围</p>
<h4 id="1-1、配置-SystemMessage">1.1、配置@SystemMessage</h4>
<p>在SeparateChatAssistant类的chat方法上添加@SystemMessage注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SystemMessage(&quot;你是我的好朋友，请用东北话回答问题。&quot;)</span><span class="comment">//系统消息提示词</span></span><br><span class="line">String <span class="title function_">chat</span><span class="params">(<span class="meta">@MemoryId</span> <span class="type">int</span> memoryId, <span class="meta">@UserMessage</span> String userMessage)</span>;</span><br></pre></td></tr></table></figure>
<p><code>@SystemMessage</code>的内容将在后台转换为 <code>SystemMessage</code>对象，并与 <code>UserMessage</code> 一起发送给大语言模型（LLM）。</p>
<p>SystemMessaged的内容只会发送给大模型一次。</p>
<p>如果你修改了SystemMessage的内容，新的SystemMessage会被发送给大模型，之前的聊天记忆会失效。</p>
<h4 id="1-2、测试">1.2、测试</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PromptTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SeparateChatAssistant separateChatAssistant;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSystemMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">answer</span> <span class="operator">=</span> separateChatAssistant.chat(<span class="number">3</span>,<span class="string">&quot;今天几号&quot;</span>);</span><br><span class="line">        System.out.println(answer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果要显示今天的日期，我们需要在提示词中添加当前日期的占位符</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SystemMessage(&quot;你是我的好朋友，请用东北话回答问题。今天是&#123;&#123;current_date&#125;&#125;&quot;)</span><span class="comment">//系统消息提示词</span></span><br><span class="line">String <span class="title function_">chat</span><span class="params">(<span class="meta">@MemoryId</span> <span class="type">int</span> memoryId, <span class="meta">@UserMessage</span> String userMessage)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="1-3、从资源中加载提示模板">1.3、从资源中加载提示模板</h4>
<p><code>@SystemMessage</code> 注解还可以从资源中加载提示模板：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SystemMessage(fromResource = &quot;my-prompt-template.txt&quot;)</span></span><br><span class="line">String <span class="title function_">chat</span><span class="params">(<span class="meta">@MemoryId</span> <span class="type">int</span> memoryId, <span class="meta">@UserMessage</span> String userMessage)</span>;</span><br></pre></td></tr></table></figure>
<p>my-prompt-template.txt</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">你是我的好朋友，请用东北话回答问题，回答问题的时候适当添加表情符号。</span><br></pre></td></tr></table></figure>
表示当前日期
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">你是我的好朋友，请用东北话回答问题，回答问题的时候适当添加表情符号。</span><br><span class="line">今天是 &#123;&#123;current_date&#125;&#125;。</span><br></pre></td></tr></table></figure>
<h3 id="2、用户提示词模板">2、用户提示词模板</h3>
<p>**@UserMessage：**获取用户输入</p>
<h4 id="2-1、配置-UserMessage">2.1、配置@UserMessage</h4>
<p>在<code>MemoryChatAssistant</code>的<code>chat</code>方法中添加注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@UserMessage(&quot;你是我的好朋友，请用上海话回答问题，并且添加一些表情符号。 &#123;&#123;it&#125;&#125;&quot;)</span> <span class="comment">//&#123;&#123;it&#125;&#125;表示这里唯一的参数的占位符</span></span><br><span class="line">String <span class="title function_">chat</span><span class="params">(String message)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="2-2、测试">2.2、测试</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> MemoryChatAssistant memoryChatAssistant;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUserMessage</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">answer</span> <span class="operator">=</span> memoryChatAssistant.chat(<span class="string">&quot;我是环环&quot;</span>);</span><br><span class="line">    System.out.println(answer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3、指定参数名称">3、指定参数名称</h3>
<h4 id="3-1、配置-V">3.1、配置@V</h4>
<p><strong>@V</strong> 明确指定传递的参数名称</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@UserMessage(&quot;你是我的好朋友，请用上海话回答问题，并且添加一些表情符号。&#123;&#123;message&#125;&#125;&quot;)</span></span><br><span class="line">String <span class="title function_">chat</span><span class="params">(<span class="meta">@V(&quot;message&quot;)</span> String userMessage)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="3-2、多个参数的情况">3.2、多个参数的情况</h4>
<p>如果有两个或两个以上的参数，我们必须要用<code>@V</code>，在<code>SeparateChatAssistant</code>中定义方法<code>chat2</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@UserMessage(&quot;你是我的好朋友，请用粤语回答问题。&#123;&#123;message&#125;&#125;&quot;)</span></span><br><span class="line">String <span class="title function_">chat2</span><span class="params">(<span class="meta">@MemoryId</span> <span class="type">int</span> memoryId, <span class="meta">@V(&quot;message&quot;)</span> String userMessage)</span>;</span><br></pre></td></tr></table></figure>
<p>测试：<code>@UserMessage</code>中的内容每次都会被和用户问题组织在一起发送给大模型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testV</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">answer1</span> <span class="operator">=</span> separateChatAssistant.chat2(<span class="number">1</span>, <span class="string">&quot;我是环环&quot;</span>);</span><br><span class="line">    System.out.println(answer1);</span><br><span class="line">    <span class="type">String</span> <span class="variable">answer2</span> <span class="operator">=</span> separateChatAssistant.chat2(<span class="number">1</span>, <span class="string">&quot;我是谁&quot;</span>);</span><br><span class="line">    System.out.println(answer2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-3、-SystemMessage和-V">3.3、@SystemMessage和@V</h4>
<p>也可以将<code>@SystemMessage</code>和<code>@V</code>结合使用</p>
<p>在<code>SeparateChatAssistant</code>中添加方法chat3</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SystemMessage(fromResource = &quot;my-prompt-template3.txt&quot;)</span></span><br><span class="line">String <span class="title function_">chat3</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@MemoryId</span> <span class="type">int</span> memoryId, </span></span><br><span class="line"><span class="params">    <span class="meta">@UserMessage</span> String userMessage, </span></span><br><span class="line"><span class="params">    <span class="meta">@V(&quot;username&quot;)</span> String username, </span></span><br><span class="line"><span class="params">    <span class="meta">@V(&quot;age&quot;)</span> <span class="type">int</span> age</span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>
<p>创建提示词模板my-prompt-template3.txt，添加占位符</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">你是我的好朋友，我是&#123;&#123;username&#125;&#125;，我的年龄是&#123;&#123;age&#125;&#125;，请用东北话回答问题，回答问题的时候适当添加表情符号。</span><br><span class="line">今天是 &#123;&#123;current_date&#125;&#125;。</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUserInfo</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">answer</span> <span class="operator">=</span> separateChatAssistant.chat3(<span class="number">1</span>, <span class="string">&quot;我是谁，我多大了&quot;</span>, <span class="string">&quot;翠花&quot;</span>, <span class="number">18</span>);</span><br><span class="line">    System.out.println(answer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="七、项目实战-创建硅谷小智">七、项目实战-创建硅谷小智</h2>
<p>这部分我们实现硅谷小智的基本聊天功能，包含聊天记忆、聊天记忆持久化、提示词</p>
<h3 id="1、创建硅谷小智">1、创建硅谷小智</h3>
<p>创建XiaozhiAgent</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.assistant;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.*;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.spring.AiService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> dev.langchain4j.service.spring.AiServiceWiringMode.EXPLICIT;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AiService(</span></span><br><span class="line"><span class="meta">        wiringMode = EXPLICIT,</span></span><br><span class="line"><span class="meta">        chatModel = &quot;qwenChatModel&quot;,</span></span><br><span class="line"><span class="meta">        chatMemoryProvider = &quot;chatMemoryProviderXiaozhi&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">XiaozhiAgent</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@SystemMessage(fromResource = &quot;zhaozhi-prompt-template.txt&quot;)</span></span><br><span class="line">    String <span class="title function_">chat</span><span class="params">(<span class="meta">@MemoryId</span> Long memoryId, <span class="meta">@UserMessage</span> String userMessage)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2、提示词模板">2、提示词模板</h3>
<p>zhaozhi-prompt-template.txt</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">你的名字是“硅谷小智”，你是一家名为“北京协和医院”的智能客服。</span><br><span class="line">你是一个训练有素的医疗顾问和医疗伴诊助手。</span><br><span class="line">你态度友好、礼貌且言辞简洁。</span><br><span class="line"></span><br><span class="line">1、请仅在用户发起第一次会话时，和用户打个招呼，并介绍你是谁。</span><br><span class="line"></span><br><span class="line">2、作为一个训练有素的医疗顾问：</span><br><span class="line">请基于当前临床实践和研究，针对患者提出的特定健康问题，提供详细、准确且实用的医疗建议。请同时考虑可能的病因、诊断流程、治疗方案以及预防措施，并给出在不同情境下的应对策略。对于药物治疗，请特别指明适用的药品名称、剂量和疗程。如果需要进一步的检查或就医，也请明确指示。</span><br><span class="line"></span><br><span class="line">3、作为医疗伴诊助手，你可以回答用户就医流程中的相关问题，主要包含以下功能：</span><br><span class="line">AI分导诊：根据患者的病情和就医需求，智能推荐最合适的科室。</span><br><span class="line">AI挂号助手：实现智能查询是否有挂号号源服务；实现智能预约挂号服务；实现智能取消挂号服务。</span><br><span class="line"></span><br><span class="line">4、你必须遵守的规则如下：</span><br><span class="line">在获取挂号预约详情或取消挂号预约之前，你必须确保自己知晓用户的姓名（必选）、身份证号（必选）、预约科室（必选）、预约日期（必选，格式举例：2025-04-14）、预约时间（必选，格式：上午 或 下午）、预约医生（可选）。</span><br><span class="line">当被问到其他领域的咨询时，要表示歉意并说明你无法在这方面提供帮助。</span><br><span class="line"></span><br><span class="line">5、请在回答的结果中适当包含一些轻松可爱的图标和表情。</span><br><span class="line"></span><br><span class="line">6、今天是 &#123;&#123;current_date&#125;&#125;。</span><br></pre></td></tr></table></figure>
<h3 id="3、配置小智助手">3、配置小智助手</h3>
<p>配置持久化和记忆隔离</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.config;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XiaozhiAgentConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MongoChatMemoryStore mongoChatMemoryStore;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    ChatMemoryProvider <span class="title function_">chatMemoryProviderXiaozhi</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> memoryId -&gt; MessageWindowChatMemory.builder()</span><br><span class="line">                .id(memoryId)</span><br><span class="line">                .maxMessages(<span class="number">20</span>)</span><br><span class="line">                .chatMemoryStore(mongoChatMemoryStore)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="4、封装对话对象">4、封装对话对象</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.bean;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatForm</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long memoryId;<span class="comment">//对话id</span></span><br><span class="line">    <span class="keyword">private</span> String message;<span class="comment">//用户问题</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5、添加Controller方法">5、添加Controller方法</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Tag(name = &quot;硅谷小智&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/xiaozhi&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XiaozhiController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> XiaozhiAgent xiaozhiAgent;</span><br><span class="line">    <span class="meta">@Operation(summary = &quot;对话&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/chat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">chat</span><span class="params">(<span class="meta">@RequestBody</span> ChatForm chatForm)</span>  &#123;</span><br><span class="line">        <span class="keyword">return</span> xiaozhiAgent.chat(chatForm.getMemoryId(), chatForm.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6、待优化">6、待优化</h3>
<p>信息查询：提示词中还应该提供医院信息（如位置信息，营业时间等）、科室信息（都有哪些科室）、医生信息（都有哪些医生）</p>
<p>业务实现：预约、取消预约、查询是否预约等</p>
<p>信息查询可以使用RAG检索增强生成</p>
<p>业务实现需要通过Function Calling函数调用</p>
<h2 id="八、-Function-Calling-函数调用">八、 Function Calling 函数调用</h2>
<p><code>Function Calling 函数调用</code> 也叫  <code>Tools 工具</code></p>
<h3 id="1、入门案例">1、入门案例</h3>
<p>例如，大语言模型本身并不擅长数学运算。如果应用场景中偶尔会涉及到数学计算，我们可以为他提供一个 “数学工具”。当我们提出问题时，大语言模型会判断是否使用某个工具。</p>
<h4 id="1-1、创建工具类">1.1、创建工具类</h4>
<p>用 <code>@Tool</code> 注解的方法：</p>
<ul>
<li>既可以是静态的，也可以是非静态的；</li>
<li>可以具有任何可见性（公有、私有等）。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.tools;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalculatorTools</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Tool</span></span><br><span class="line">    <span class="type">double</span> <span class="title function_">sum</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;调用加法运算&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Tool</span></span><br><span class="line">    <span class="type">double</span> <span class="title function_">squareRoot</span><span class="params">(<span class="type">double</span> x)</span> &#123;</span><br><span class="line">         System.out.println(<span class="string">&quot;调用平方根运算&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Math.sqrt(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-2、配值工具类">1.2、配值工具类</h4>
<p>在SeparateChatAssistant中添加tools属性配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AiService(</span></span><br><span class="line"><span class="meta">        wiringMode = EXPLICIT,</span></span><br><span class="line"><span class="meta">        chatModel = &quot;qwenChatModel&quot;,</span></span><br><span class="line"><span class="meta">        chatMemoryProvider = &quot;chatMemoryProvider&quot;,</span></span><br><span class="line"><span class="meta">        tools = &quot;calculatorTools&quot; //配置tools</span></span><br><span class="line"><span class="meta">)</span></span><br></pre></td></tr></table></figure>
<h4 id="1-3、测试工具类">1.3、测试工具类</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ToolsTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SeparateChatAssistant separateChatAssistant;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCalculatorTools</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">answer</span> <span class="operator">=</span> separateChatAssistant.chat(<span class="number">1</span>, <span class="string">&quot;1+2等于几，475695037565的平方根是多少？&quot;</span>);</span><br><span class="line">        <span class="comment">//答案：3，689706.4865</span></span><br><span class="line">        System.out.println(answer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试后可以查看持久化存储中SYSTEM、USER、AI以及Tools的消息，分析tools的调用流程：</p>
<figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Request</span><span class="punctuation">:</span></span><br><span class="line"><span class="attribute">\- messages</span><span class="punctuation">:</span></span><br><span class="line">	<span class="attribute">\- SystemMessage</span><span class="punctuation">:</span></span><br><span class="line">		<span class="attribute">\- text</span><span class="punctuation">:</span> <span class="string">系统定义AI的角色</span></span><br><span class="line">    <span class="attribute">\- UserMessage</span><span class="punctuation">:</span></span><br><span class="line">        <span class="attribute">\- text</span><span class="punctuation">:</span> <span class="string">用户提问</span></span><br><span class="line">    <span class="attribute">\- AiMessage</span><span class="punctuation">:</span></span><br><span class="line">        <span class="attribute">\- toolExecutionRequests</span><span class="punctuation">:</span></span><br><span class="line">            <span class="attribute">\- ai获取提问信息组织参数调用工具方法</span></span><br><span class="line"><span class="attribute">    \- ToolExecutionResultMessage</span><span class="punctuation">:</span></span><br><span class="line">        <span class="attribute">\- text</span><span class="punctuation">:</span> <span class="string">工具方法执行</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">Response </span><span class="punctuation">:</span></span><br><span class="line"><span class="attribute">\- AiMessage</span><span class="punctuation">:</span></span><br><span class="line">    <span class="attribute">\- text</span><span class="punctuation">:</span> <span class="string">根据工具方法的执行ai再次组织结果返回</span></span><br></pre></td></tr></table></figure>
<h3 id="2、-Tool-注解的可选字段">2、@Tool 注解的可选字段</h3>
<p><code>@Tool</code> 注解有两个可选字段：</p>
<ul>
<li><strong>name（工具名称）</strong>：工具的名称。如果未提供该字段，方法名会作为工具的名称。</li>
<li><strong>value（工具描述）</strong>：工具的描述信息。</li>
</ul>
<p>根据工具的不同，即使没有任何描述，大语言模型可能也能很好地理解它（例如，<code>add(a, b)</code> 就很直观），但通常最好提供清晰且有意义的名称和描述。这样，大语言模型就能获得更多信息，以决定是否调用给定的工具以及如何调用。</p>
<h3 id="3、-P-注解">3、@P 注解</h3>
<p>方法参数可以选择使用 <code>@P</code> 注解进行标注。</p>
<p><code>@P</code> 注解有两个字段：</p>
<ul>
<li><strong>value</strong>：参数的描述信息，这是必填字段。</li>
<li><strong>required</strong>：表示该参数是否为必需项，默认值为 <code>true</code>，此为可选字段。</li>
</ul>
<h3 id="4、-ToolMemoryId">4、@ToolMemoryId</h3>
<p>如果你的AIService方法中有一个参数使用 <code>@MemoryId</code> 注解，那么你也可以使用 <code>@ToolMemoryId</code> 注解 <code>@Tool</code> 方法中的一个参数。提供给AIService方法的值将自动传递给 <code>@Tool</code> 方法。如果你有多个用户，或每个用户有多个聊天记忆，并且希望在 <code>@Tool</code> 方法中对它们进行区分，那么这个功能会很有用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.tools;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalculatorTools</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Tool(name = &quot;加法&quot;, value = &quot;返回两个参数相加之和&quot;)</span></span><br><span class="line">    <span class="type">double</span> <span class="title function_">sum</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ToolMemoryId</span> <span class="type">int</span> memoryId,</span></span><br><span class="line"><span class="params">            <span class="meta">@P(value=&quot;加数1&quot;, required = true)</span> <span class="type">double</span> a,</span></span><br><span class="line"><span class="params">            <span class="meta">@P(value=&quot;加数2&quot;, required = true)</span> <span class="type">double</span> b)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;调用加法运算 &quot;</span> + memoryId);</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Tool(name = &quot;平方根&quot;, value = &quot;返回给定参数的平方根&quot;)</span></span><br><span class="line">    <span class="type">double</span> <span class="title function_">squareRoot</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ToolMemoryId</span> <span class="type">int</span> memoryId, <span class="type">double</span> x)</span> &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;调用平方根运算 &quot;</span> + memoryId);</span><br><span class="line">        <span class="keyword">return</span> Math.sqrt(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="九、项目实战-优化硅谷小智">九、项目实战-优化硅谷小智</h2>
<h3 id="1、预约业务的实现">1、预约业务的实现</h3>
<p>这部分我们实现硅谷小智的查询订单、预约订单、取消订单的功能</p>
<h4 id="1-1、创建MySQL数据库表">1.1、创建MySQL数据库表</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE `guiguxiaozhi`;</span><br><span class="line">USE `guiguxiaozhi`;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> `appointment` (</span><br><span class="line">  `id` <span class="type">BIGINT</span> <span class="keyword">NOT NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `username` <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `id_card` <span class="type">VARCHAR</span>(<span class="number">18</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `department` <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `<span class="type">date</span>` <span class="type">VARCHAR</span>(<span class="number">10</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `<span class="type">time</span>` <span class="type">VARCHAR</span>(<span class="number">10</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `doctor_name` <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">   <span class="keyword">PRIMARY KEY</span> (`id`)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h4 id="1-2、引入依赖">1.2、引入依赖</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Mysql Connector --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mybatis-plus 持久层--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-spring-boot3-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-plus.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="1-3、配置数据库连接">1.3、配置数据库连接</h4>
<p>application.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基本数据源配置</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/guiguxiaozhi?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai&amp;useSSL=false</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="comment"># 开启 SQL 日志打印</span></span><br><span class="line"><span class="attr">mybatis-plus.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure>
<h4 id="1-4、创建实体类">1.4、创建实体类</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.entity;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Appointment</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String idCard;</span><br><span class="line">    <span class="keyword">private</span> String department;</span><br><span class="line">    <span class="keyword">private</span> String date;</span><br><span class="line">    <span class="keyword">private</span> String time;</span><br><span class="line">    <span class="keyword">private</span> String doctorName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-5、Mapper">1.5、Mapper</h4>
<p>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AppointmentMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Appointment&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>xml：在resources下创建mapper目录，创建AppointmentMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.atguigu.java.ai.langchain4j.mapper.AppointmentMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="1-6、Service">1.6、Service</h4>
<p>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AppointmentService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Appointment&gt; &#123;</span><br><span class="line">    Appointment <span class="title function_">getOne</span><span class="params">(Appointment appointment)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppointmentServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;AppointmentMapper, Appointment&gt; <span class="keyword">implements</span> <span class="title class_">AppointmentService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询订单是否存在</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> appointment</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Appointment <span class="title function_">getOne</span><span class="params">(Appointment appointment)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Appointment&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(Appointment::getUsername, appointment.getUsername());</span><br><span class="line">        queryWrapper.eq(Appointment::getIdCard, appointment.getIdCard());</span><br><span class="line">        queryWrapper.eq(Appointment::getDepartment, appointment.getDepartment());</span><br><span class="line">        queryWrapper.eq(Appointment::getDate, appointment.getDate());</span><br><span class="line">        queryWrapper.eq(Appointment::getTime, appointment.getTime());</span><br><span class="line"></span><br><span class="line">        <span class="type">Appointment</span> <span class="variable">appointmentDB</span> <span class="operator">=</span> baseMapper.selectOne(queryWrapper);</span><br><span class="line">        <span class="keyword">return</span> appointmentDB;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-7、创建测试用例">1.7、创建测试用例</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AppointmentServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AppointmentService appointmentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetOne</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Appointment</span> <span class="variable">appointment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Appointment</span>();</span><br><span class="line">        appointment.setUsername(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        appointment.setIdCard(<span class="string">&quot;123456789012345678&quot;</span>);</span><br><span class="line">        appointment.setDepartment(<span class="string">&quot;内科&quot;</span>);</span><br><span class="line">        appointment.setDate(<span class="string">&quot;2025-04-14&quot;</span>);</span><br><span class="line">        appointment.setTime(<span class="string">&quot;上午&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Appointment</span> <span class="variable">appointmentDB</span> <span class="operator">=</span> appointmentService.getOne(appointment);</span><br><span class="line">        System.out.println(appointmentDB);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSave</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Appointment</span> <span class="variable">appointment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Appointment</span>();</span><br><span class="line">        appointment.setUsername(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        appointment.setIdCard(<span class="string">&quot;123456789012345678&quot;</span>);</span><br><span class="line">        appointment.setDepartment(<span class="string">&quot;内科&quot;</span>);</span><br><span class="line">        appointment.setDate(<span class="string">&quot;2025-04-14&quot;</span>);</span><br><span class="line">        appointment.setTime(<span class="string">&quot;上午&quot;</span>);</span><br><span class="line">        appointment.setDoctorName(<span class="string">&quot;张医生&quot;</span>);</span><br><span class="line"></span><br><span class="line">        appointmentService.save(appointment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testRemoveById</span><span class="params">()</span> &#123;</span><br><span class="line">        appointmentService.removeById(<span class="number">1L</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2、Tools">2、Tools</h3>
<h4 id="2-1、创建Tools">2.1、创建Tools</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.tools;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.java.ai.langchain4j.entity.Appointment;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.java.ai.langchain4j.service.AppointmentService;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.agent.tool.P;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.agent.tool.Tool;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppointmentTools</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AppointmentService appointmentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Tool(name=&quot;预约挂号&quot;, value = &quot;根据参数，先执行工具方法queryDepartment查询是否可预约，并直接给用户回答是否可预约，并让用户确认所有预约信息，用户确认后再进行预约。&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">bookAppointment</span><span class="params">(Appointment appointment)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查找数据库中是否包含对应的预约记录</span></span><br><span class="line">        <span class="type">Appointment</span> <span class="variable">appointmentDB</span> <span class="operator">=</span> appointmentService.getOne(appointment);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(appointmentDB == <span class="literal">null</span>)&#123;</span><br><span class="line">            appointment.setId(<span class="literal">null</span>);<span class="comment">//防止大模型幻觉设置了id</span></span><br><span class="line">            <span class="keyword">if</span>(appointmentService.save(appointment))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;预约成功，并返回预约详情&quot;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;预约失败&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;您在相同的科室和时间已有预约&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Tool(name=&quot;取消预约挂号&quot;, value = &quot;根据参数，查询预约是否存在，如果存在则删除预约记录并返回取消预约成功，否则返回取消预约失败&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">cancelAppointment</span><span class="params">(Appointment appointment)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Appointment</span> <span class="variable">appointmentDB</span> <span class="operator">=</span> appointmentService.getOne(appointment);</span><br><span class="line">        <span class="keyword">if</span>(appointmentDB != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//删除预约记录</span></span><br><span class="line">            <span class="keyword">if</span>(appointmentService.removeById(appointmentDB.getId()))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;取消预约成功&quot;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;取消预约失败&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//取消失败</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;您没有预约记录，请核对预约科室和时间&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Tool(name = &quot;查询是否有号源&quot;, value=&quot;根据科室名称，日期，时间和医生查询是否有号源，并返回给用户&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">queryDepartment</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@P(value = &quot;科室名称&quot;)</span> String name,</span></span><br><span class="line"><span class="params">            <span class="meta">@P(value = &quot;日期&quot;)</span> String date,</span></span><br><span class="line"><span class="params">            <span class="meta">@P(value = &quot;时间，可选值：上午、下午&quot;)</span> String time,</span></span><br><span class="line"><span class="params">            <span class="meta">@P(value = &quot;医生名称&quot;, required = false)</span> String doctorName</span></span><br><span class="line"><span class="params">    )</span> &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;查询是否有号源&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;科室名称：&quot;</span> + name);</span><br><span class="line">        System.out.println(<span class="string">&quot;日期：&quot;</span> + date);</span><br><span class="line">        System.out.println(<span class="string">&quot;时间：&quot;</span> + time);</span><br><span class="line">        System.out.println(<span class="string">&quot;医生名称：&quot;</span> + doctorName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//TODO 维护医生的排班信息：</span></span><br><span class="line">        <span class="comment">//如果没有指定医生名字，则根据其他条件查询是否有可以预约的医生（有返回true，否则返回false）；</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果指定了医生名字，则判断医生是否有排班（没有排版返回false）</span></span><br><span class="line">        <span class="comment">//如果有排班，则判断医生排班时间段是否已约满（约满返回false，有空闲时间返回true）</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2、配置Tools">2.2、配置Tools</h4>
<p>在<code>XiaozhiAgent</code>中添加<code>tools</code>配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AiService(</span></span><br><span class="line"><span class="meta">        wiringMode = EXPLICIT,</span></span><br><span class="line"><span class="meta">        chatModel = &quot;qwenChatModel&quot;,</span></span><br><span class="line"><span class="meta">        chatMemoryProvider = &quot;chatMemoryProviderXiaozhi&quot;,</span></span><br><span class="line"><span class="meta">        tools = &quot;appointmentTools&quot; //tools配置</span></span><br><span class="line"><span class="meta">)</span></span><br></pre></td></tr></table></figure>
<h4 id="2-3、测试">2.3、测试</h4>
<p>在Controller中测试</p>
<h2 id="十、检索增强生成-RAG">十、检索增强生成 RAG</h2>
<h3 id="1、如何让大模型回答专业领域的知识">1、如何让大模型回答专业领域的知识</h3>
<p>LLM 的知识仅限于它所训练的数据。 如果你想让 LLM 了解特定领域的知识或专有数据，你可以：</p>
<ul>
<li><code>使用 RAG</code></li>
<li>使用你的数据微调 LLM</li>
<li>结合 RAG 和微调</li>
</ul>
<h4 id="1-1、微调大模型">1.1、微调大模型</h4>
<p>在现有大模型的基础上，使用小规模的特定任务数据进行再次训练，调整模型参数，让模型更精确地处理特定领域或任务的数据。更新需重新训练，计算资源和时间成本高。</p>
<ul>
<li>优点：一次会话只需一次模型调用，速度快，在特定任务上性能更高，准确性也更高。</li>
<li>缺点：知识更新不及时，模型训成本高、训练周期长。</li>
<li>应用场景：适合知识库稳定、对生成内容准确性和风格要求高的场景，如对上下文理解和语言生成质量要求高的文学创作、专业文档生成等。</li>
</ul>
<h4 id="1-2、RAG">1.2、RAG</h4>
<p><strong>R</strong>etrieval-<strong>A</strong>ugmented <strong>G</strong>eneration 检索增强生成</p>
<p>将原始问题以及提示词信息发送给大语言模型之前，先通过外部知识库检索相关信息，然后将检索结果和原始问题一起发送给大模型，大模型依据外部知识库再结合自身的训练数据，组织自然语言回答问题。通过这种方式，大语言模型可以获取到特定领域的相关信息，并能够利用这些信息进行回复。</p>
<ul>
<li>优点：数据存储在外部知识库，可以实时更新，不依赖对模型自身的训练，成本更低。</li>
<li>缺点：需要两次查询：先查询知识库，然后再查询大模型，性能不如微调大模型</li>
<li>应用场景：适用于知识库规模大且频繁更新的场景，如企业客服、实时新闻查询、法律和医疗领域的最新知识问答等。</li>
</ul>
<h4 id="1-3、RAG常用方法">1.3、RAG常用方法</h4>
<ul>
<li><code>全文（关键词）搜索。</code>这种方法通过将问题和提示词中的关键词与知识库文档数据库进行匹配来搜索文档。根据这些关键词在每个文档中的出现频率和相关性对搜索结果进行排序。</li>
<li><code>向量搜索</code>，也被称为 “语义搜索”。文本通过<code>嵌入模型</code>被转换为<code>数字向量</code>。然后，它根据查询向量与文档向量之间的余弦相似度或其他相似性 / 距离度量来查找和排序文档，从而捕捉更深层次的语义含义。</li>
<li><code>混合搜索。</code>结合多种搜索方法（例如，全文搜索 + 向量搜索）通常可以提高搜索的效果。</li>
</ul>
<h3 id="2、向量搜索-vector-search">2、向量搜索 vector search</h3>
<h4 id="2-1、向量-Vectors">2.1、向量 Vectors</h4>
<p>可以将向量理解为从空间中的一个点到另一个点的移动。例如，在下图中，我们可以看到一些二维空间中的向量：</p>
<blockquote>
<p><strong>a</strong>是一个从 (100, 50) 到 (-50, -50) 的向量，<strong>b</strong> 是一个从 (0, 0) 到 (100, -50) 的向量。</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://photo.459122.xyz/i/1fb641893d2d92def7390e4bc94a52fc.jpg" alt="v2-55c2f61aceb86313711d50a5e6e9f8fd_1440w-1749129441877-1"></p>
<p>很多时候，我们处理的向量是从原点 (0, 0) 开始的，比如<strong>b</strong>。这样我们可以省略向量起点部分，直接说 <strong>b</strong> 是向量 (100, -50)。</p>
<p>如何将向量的概念扩展到非数值实体上呢（例如文本）？</p>
<h4 id="2-2、维度-Dimensions">2.2、维度 Dimensions</h4>
<p>如我们所见，每个数值向量都有 x 和 y 坐标（或者在多维系统中是 x、y、z，…）。x、y、z… 是这个向量空间的轴，称为维度。对于我们想要表示为向量的一些非数值实体，我们首先需要决定这些维度，并为每个实体在每个维度上分配一个值。</p>
<p>例如，在一个交通工具数据集中，我们可以定义四个维度：“轮子数量”、“是否有发动机”、“是否可以在地上开动”和“最大乘客数”。然后我们可以将一些车辆表示为：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://photo.459122.xyz/i/503f03ce04bb22c85550de052eac5287.jpg" alt="v2-b88f750dc797da4f9cc45da0fdd482dc_1440w-1749129500192-3"></p>
<p>因此，我们的汽车Car向量将是 (4, yes, yes, 5)，或者用数值表示为 (4, 1, 1, 5)（将 yes 设为 1，no 设为 0）。</p>
<p>向量的每个维度代表数据的不同特性，维度越多对事务的描述越精确，我们可以使用“是否有翅膀”、“是否使用柴油”、“最高速度”、“平均重量”、“价格”等等更多的维度信息。</p>
<h4 id="2-3、相似度-Similarity">2.3、相似度 Similarity</h4>
<p>如果用户搜索<code>“轿车Car”</code>，你希望能够返回所有与<code>“汽车automobile”</code>和<code>“车辆vehicle”</code>等信息相关的结果。向量搜索就是实现这个目标的一种方法。</p>
<p><strong>如何确定哪些是最相似的？</strong></p>
<p>每个向量都有一个长度和方向。例如，在这个图中，p 和 a 指向相同的方向，但长度不同。p 和 b 正好指向相反的方向，但有相同的长度。然后还有c，长度比p短一点，方向不完全相同，但很接近。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://photo.459122.xyz/i/bd4e8b27905f5bb7610b5a9fe2b4791c.jpg" alt="v2-db52b20a89a5dc3bde66da11691a7438_1440w-1749129540021-5"></p>
<p>那么，哪一个最接近 p 呢？</p>
<p>如果“相似”仅仅意味着指向相似的方向，那么a 是最接近 p 的。接下来是 c。b 是最不相似的，因为它正好指向与p 相反的方向。如果“相似”仅仅意味着相似的长度，那么 b 是最接近 p 的（因为它有相同的长度），接下来是 c，然后是 a。</p>
<p>由于向量通常用于描述语义意义，仅仅看长度通常无法满足需求。<strong>大多数相似度测量要么仅依赖于方向，要么同时考虑方向和大小。</strong></p>
<h4 id="2-4、相似度测量-Measures-of-similarity">2.4、相似度测量 Measures of similarity</h4>
<p>相似度测量即相似度计算。四种常见的向量相似度计算方法（这里不展开讨论）：</p>
<ul>
<li>欧几里得距离 Euclidean distance</li>
<li>曼哈顿距离 Manhattan distance</li>
<li>点积 Dot product</li>
<li>余弦相似度 Cosine similarity</li>
</ul>
<h3 id="3、RAG的过程">3、RAG的过程</h3>
<p><strong>RAG 过程分为 2 个不同的阶段：索引和检索。</strong></p>
<h4 id="3-1、索引阶段">3.1、索引阶段</h4>
<p>在索引阶段，对知识库文档进行预处理，可实现检索阶段的高效搜索。</p>
<ul>
<li>以下是索引阶段的简化图：</li>
</ul>
<p>加载知识库文档 ==&gt; 将文档中的<strong>文本分段</strong> ==&gt; 利用<strong>向量大模型</strong>将分段后的<strong>文本转换成向量</strong> ==&gt; 将向量<strong>存入向量数据库</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://photo.459122.xyz/i/6774dc7e3f4e0b0428de056229c76784.png" alt="image-20250420170954862-1749129593484-7"></p>
<p><strong>为什么要进行文本分段？</strong></p>
<p>大语言模型（LLM）的上下文窗口有限，所以整个知识库可能无法全部容纳其中。</p>
<ul>
<li>你在提问中提供的信息越多，大语言模型处理并做出回应所需的时间就越长。</li>
<li>你在提问中提供的信息越多，花费也就越多。</li>
<li>提问中的无关信息可能会干扰大语言模型，增加产生幻觉（生成错误信息）的几率。</li>
</ul>
<p>我们可以通过将知识库分割成更小、更易于理解的片段来解决这些问题。</p>
<h4 id="3-2、检索阶段">3.2、检索阶段</h4>
<ul>
<li>以下是检索阶段的简化图：</li>
</ul>
<p>通过向量模型<strong>将用户查询转换成向量</strong> ==&gt; 在向量数据库中根据用户查询进行<strong>相似度匹配</strong> ==&gt; 将用户查询和向量数据库中匹配到的相关内容一起交给LLM处理</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://photo.459122.xyz/i/9c2faba61363b1b2537a5fbdba6de2c3.png" alt="rag-retrieval-f525d2937abc08fed5cec36a7f08a4c3-1749129674191-9"></p>
<h3 id="4、文档加载器-Document-Loader">4、文档加载器 Document Loader</h3>
<h4 id="4-1、常见文档加载器">4.1、常见文档加载器</h4>
<ul>
<li><code>来自 langchain4j 模块的文件系统文档加载器（FileSystemDocumentLoader）</code></li>
<li>来自 langchain4j 模块的类路径文档加载器（ClassPathDocumentLoader）</li>
<li>来自 langchain4j 模块的网址文档加载器（UrlDocumentLoader）</li>
<li>来自 langchain4j-document-loader-amazon-s3 模块的亚马逊 S3 文档加载器（AmazonS3DocumentLoader）</li>
<li>来自 langchain4j-document-loader-azure-storage-blob 模块的 Azure Blob 存储文档加载器（AzureBlobStorageDocumentLoader）</li>
<li>来自 langchain4j-document-loader-github 模块的 GitHub 文档加载器（GitHubDocumentLoader）</li>
<li>来自 langchain4j-document-loader-google-cloud-storage 模块的谷歌云存储文档加载器（GoogleCloudStorageDocumentLoader）</li>
<li>来自 langchain4j-document-loader-selenium 模块的 Selenium 文档加载器（SeleniumDocumentLoader）</li>
<li>来自 langchain4j-document-loader-tencent-cos 模块的腾讯云对象存储文档加载器（TencentCosDocumentLoader）</li>
</ul>
<h4 id="4-2、测试文档加载">4.2、测试文档加载</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RAGTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testReadDocument</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//使用FileSystemDocumentLoader读取指定目录下的知识库文档</span></span><br><span class="line">        <span class="comment">//并使用默认的文档解析器TextDocumentParser对文档进行解析</span></span><br><span class="line">        <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> FileSystemDocumentLoader.loadDocument(<span class="string">&quot;E:/knowledge/测试.txt&quot;</span>);</span><br><span class="line">        System.out.println(document.text());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其他加载文档的方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载单个文档</span></span><br><span class="line"><span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> FileSystemDocumentLoader.loadDocument(<span class="string">&quot;E:/knowledge/file.txt&quot;</span>, <span class="keyword">new</span> <span class="title class_">TextDocumentParser</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从一个目录中加载所有文档</span></span><br><span class="line">List&lt;Document&gt; documents = FileSystemDocumentLoader.loadDocuments(<span class="string">&quot;E:/knowledge&quot;</span>, <span class="keyword">new</span> <span class="title class_">TextDocumentParser</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从一个目录中加载所有的.txt文档</span></span><br><span class="line"><span class="type">PathMatcher</span> <span class="variable">pathMatcher</span> <span class="operator">=</span> FileSystems.getDefault().getPathMatcher(<span class="string">&quot;glob:*.txt&quot;</span>);</span><br><span class="line">List&lt;Document&gt; documents = FileSystemDocumentLoader.loadDocuments(<span class="string">&quot;E:/knowledge&quot;</span>, pathMatcher, <span class="keyword">new</span> <span class="title class_">TextDocumentParser</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从一个目录及其子目录中加载所有文档</span></span><br><span class="line">List&lt;Document&gt; documents = FileSystemDocumentLoader.loadDocumentsRecursively(<span class="string">&quot;E:/knowledge&quot;</span>, <span class="keyword">new</span> <span class="title class_">TextDocumentParser</span>());</span><br></pre></td></tr></table></figure>
<h3 id="5、文档解析器-Document-Parser">5、文档解析器 Document Parser</h3>
<h4 id="5-1、常见文档解析器">5.1、常见文档解析器</h4>
<p>文档可以是各种格式的文件，比如 PDF、DOC、TXT 等等。为了解析这些不同格式的文件，有一个 “文档解析器”（DocumentParser）接口，并且我们的库中包含了该接口的几种实现方式：</p>
<ul>
<li><code>来自 langchain4j 模块的文本文档解析器（TextDocumentParser），它能够解析纯文本格式的文件（例如 TXT、HTML、MD 等）。</code></li>
<li>来自 langchain4j-document-parser-apache-pdfbox 模块的 Apache PDFBox 文档解析器（ApachePdfBoxDocumentParser），它可以解析 PDF 文件。</li>
<li>来自 langchain4j-document-parser-apache-poi 模块的 Apache POI 文档解析器（ApachePoiDocumentParser），它能够解析微软办公软件的文件格式（例如 DOC、DOCX、PPT、PPTX、XLS、XLSX 等）。</li>
<li>来自 langchain4j-document-parser-apache-tika 模块的 Apache Tika 文档解析器（ApacheTikaDocumentParser），它可以自动检测并解析几乎所有现有的文件格式。</li>
</ul>
<p>假设如果我们想解析PDF文档，那么原有的<code>TextDocumentParser</code>就无法工作了，我们需要引入<code>langchain4j-document-parser-apache-pdfbox</code></p>
<h4 id="5-2、添加依赖">5.2、添加依赖</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--解析pdf文档--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-document-parser-apache-pdfbox<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="5-3、解析pdf文档">5.3、解析pdf文档</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解析PDF</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testParsePDF</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> FileSystemDocumentLoader.loadDocument(</span><br><span class="line">            <span class="string">&quot;E:/knowledge/医院信息.pdf&quot;</span>,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ApachePdfBoxDocumentParser</span>()</span><br><span class="line">    );</span><br><span class="line">    System.out.println(document);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6、文档分割器-Document-Splitter">6、文档分割器 Document Splitter</h3>
<h4 id="6-1、常见文档分割器">6.1、常见文档分割器</h4>
<p>LangChain4j 有一个 “文档分割器”（DocumentSplitter）接口，并且提供了几种开箱即用的实现方式：</p>
<p><code>按段落文档分割器（DocumentByParagraphSplitter）</code> 那什么叫做按照段落分割呢？两个换行符就是分段</p>
<p>但是在md文档中shift回车是一个换行符</p>
<p>按行文档分割器（DocumentByLineSplitter）</p>
<p>按句子文档分割器（DocumentBySentenceSplitter）</p>
<p>按单词文档分割器（DocumentByWordSplitter）</p>
<p>按字符文档分割器（DocumentByCharacterSplitter）</p>
<p>按正则表达式文档分割器（DocumentByRegexSplitter）</p>
<p>递归分割：DocumentSplitters.recursive (…)</p>
<p>默认情况下每个文本片段最多不能超过300个token</p>
<h4 id="6-2、测试向量转换和向量存储">6.2、测试向量转换和向量存储</h4>
<p>Embedding (Vector) Stores 常见的意思是 “嵌入（向量）存储” 。在机器学习和自然语言处理领域，Embedding 指的是将数据（如文本、图像等）转换为低维稠密向量表示的过程，这些向量能够保留数据的关键特征。而 Stores 表示存储，即用于存储这些嵌入向量的系统或工具。它们可以高效地存储和检索向量数据，支持向量相似性搜索，在文本检索、推荐系统、图像识别等任务中发挥着重要作用。</p>
<p>**Langchain4j支持的向量存储：**<a target="_blank" rel="noopener" href="https://docs.langchain4j.dev/integrations/embedding-stores/">https://docs.langchain4j.dev/integrations/embedding-stores/</a></p>
<p>添加依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--简单的rag实现--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-easy-rag<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 加载文档并存入向量数据库</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testReadDocumentAndStore</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用FileSystemDocumentLoader读取指定目录下的知识库文档</span></span><br><span class="line">    <span class="comment">//并使用默认的文档解析器对文档进行解析(TextDocumentParser)</span></span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> FileSystemDocumentLoader.loadDocument(<span class="string">&quot;E:/knowledge/人工智能.md&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//为了简单起见，我们暂时使用基于内存的向量存储</span></span><br><span class="line">    InMemoryEmbeddingStore&lt;TextSegment&gt; embeddingStore = <span class="keyword">new</span> <span class="title class_">InMemoryEmbeddingStore</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ingest</span></span><br><span class="line">    <span class="comment">//1、分割文档：默认使用递归分割器，将文档分割为多个文本片段，每个片段包含不超过 300个token，并且有 30个token的重叠部分保证连贯性</span></span><br><span class="line">    <span class="comment">//DocumentByParagraphSplitter(DocumentByLineSplitter(DocumentBySentenceSplitter(DocumentByWordSplitter)))</span></span><br><span class="line">    <span class="comment">//2、文本向量化：使用一个LangChain4j内置的轻量化向量模型对每个文本片段进行向量化</span></span><br><span class="line">    <span class="comment">//3、将原始文本和向量存储到向量数据库中(InMemoryEmbeddingStore)</span></span><br><span class="line">    EmbeddingStoreIngestor.ingest(document, embeddingStore);</span><br><span class="line">    <span class="comment">//查看向量数据库内容</span></span><br><span class="line">    System.out.println(embeddingStore);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有很多的分割器分割器下面有很多层级的子分割器</p>
<h4 id="6-3、测试文档分割">6.3、测试文档分割</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文档分割</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDocumentSplitter</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用FileSystemDocumentLoader读取指定目录下的知识库文档</span></span><br><span class="line">    <span class="comment">//并使用默认的文档解析器对文档进行解析(TextDocumentParser)</span></span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> FileSystemDocumentLoader.loadDocument(<span class="string">&quot;E:/knowledge/人工智能.md&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//为了简单起见，我们暂时使用基于内存的向量存储</span></span><br><span class="line">    InMemoryEmbeddingStore&lt;TextSegment&gt; embeddingStore = <span class="keyword">new</span> <span class="title class_">InMemoryEmbeddingStore</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//自定义文档分割器</span></span><br><span class="line">    <span class="comment">//按段落分割文档：每个片段包含不超过 300个token，并且有 30个token的重叠部分保证连贯性</span></span><br><span class="line">    <span class="comment">//注意：当段落长度总和小于设定的最大长度时，就不会有重叠的必要。</span></span><br><span class="line">    <span class="type">DocumentByParagraphSplitter</span> <span class="variable">documentSplitter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DocumentByParagraphSplitter</span>(</span><br><span class="line">            <span class="number">300</span>,</span><br><span class="line">            <span class="number">30</span>,</span><br><span class="line">            <span class="comment">//token分词器：按token计算</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">HuggingFaceTokenizer</span>());</span><br><span class="line">    <span class="comment">//按字符计算</span></span><br><span class="line">    <span class="comment">//DocumentByParagraphSplitter documentSplitter = new DocumentByParagraphSplitter(300, 30);</span></span><br><span class="line"></span><br><span class="line">    EmbeddingStoreIngestor</span><br><span class="line">            .builder()</span><br><span class="line">            .embeddingStore(embeddingStore)</span><br><span class="line">            .documentSplitter(documentSplitter)</span><br><span class="line">            .build()</span><br><span class="line">            .ingest(document);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-4、token和token计算">6.4、token和token计算</h4>
<p>DeepSeek：<a target="_blank" rel="noopener" href="https://api-docs.deepseek.com/zh-cn/quick_start/token_usage">Token 用量计算 | DeepSeek API Docs</a></p>
<p>阿里百炼：<a target="_blank" rel="noopener" href="https://bailian.console.aliyun.com/?spm=5176.29597918.J_SEsSjsNv72yRuRFS2VknO.2.18867ca0uXrEFa#/efm/model_experience_center">百炼控制台</a></p>
<p>LangChain4j：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testTokenCount</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">text</span> <span class="operator">=</span> <span class="string">&quot;这是一个示例文本，用于测试 token 长度的计算。&quot;</span>;</span><br><span class="line">    <span class="type">UserMessage</span> <span class="variable">userMessage</span> <span class="operator">=</span> UserMessage.userMessage(text);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//计算 token 长度</span></span><br><span class="line">    <span class="comment">//QwenTokenizer tokenizer = new QwenTokenizer(System.getenv(&quot;DASH_SCOPE_API_KEY&quot;), &quot;qwen-max&quot;);</span></span><br><span class="line">    <span class="type">HuggingFaceTokenizer</span> <span class="variable">tokenizer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HuggingFaceTokenizer</span>();</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> tokenizer.estimateTokenCountInMessage(userMessage);</span><br><span class="line">    System.out.println(<span class="string">&quot;token长度：&quot;</span> + count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-5、工作方式">6.5、工作方式</h4>
<ol>
<li>实例化一个 “文档分割器”（DocumentSplitter），指定所需的 “文本片段”（TextSegment）大小，并且可以选择指定characters 或token的重叠部分。</li>
<li>“文档分割器”（DocumentSplitter）将给定的文档（Document）分割成更小的单元，这些单元的性质因分割器而异。例如，“按段落分割文档器”（DocumentByParagraphSplitter）将文档分割成段落（由两个或更多连续的换行符定义），而 “按句子分割文档器”（DocumentBySentenceSplitter）使用 OpenNLP 库的句子检测器将文档分割成句子，依此类推。</li>
<li>然后，“文档分割器”（DocumentSplitter）将这些较小的单元（段落、句子、单词等）组合成 “文本片段”（TextSegment），尝试在单个 “文本片段”（TextSegment）中包含尽可能多的单元，同时不超过第一步中设置的限制。如果某些单元仍然太大，无法放入一个 “文本片段”（TextSegment）中，它会调用一个子分割器。这是另一个 “文档分割器”（DocumentSplitter），能够将不适合的单元分割成更细粒度的单元。会向每个文本片段添加一个唯一的元数据条目 “index”。第一个 “文本片段”（TextSegment）将包含 <code>index=0</code>，第二个是 <code>index=1</code>，依此类推</li>
</ol>
<p><code>模型上下文窗口</code>可以通过模型参数列表查看：<a target="_blank" rel="noopener" href="https://bailian.console.aliyun.com/?tab=doc#/doc/?type=model&amp;url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2840914.html">阿里云百炼</a></p>
<p><strong>期望的文本片段最大大小</strong></p>
<ol>
<li><strong>模型上下文窗口</strong>：如果你使用的大语言模型（LLM）有特定的上下文窗口限制，这个值不能超过模型能够处理的最大 token 数。例如，某些模型可能最大只能处理 2048 个 token，那么设置的文本片段大小就需要远小于这个值，为后续的处理（如添加指令、其他输入等）留出空间。通常，在这种情况下，你可以设置为 1000 - 1500 左右，具体根据实际情况调整。</li>
<li><strong>数据特点</strong>：如果你的文档内容较为复杂，每个段落包含的信息较多，那么可以适当提高这个值，比如设置为 500 - 800 个 token，以便在一个文本片段中包含相对完整的信息块。相反，如果文档段落较短且信息相对独立，设置为 200 - 400 个 token 可能就足够了。</li>
<li><strong>检索需求</strong>：如果希望在检索时能够更精确地匹配到相关信息，较小的文本片段可能更合适，这样可以提高信息的粒度。例如设置为 200 - 300 个 token。但如果更注重获取完整的上下文信息，较大的文本片段（如 500 - 600 个 token）可能更有助于理解相关内容。</li>
</ol>
<p><strong>重叠部分大小</strong></p>
<ol>
<li><strong>上下文连贯性</strong>：重叠部分的主要作用是提供上下文连贯性，避免因分割导致信息缺失。如果文档内容之间的逻辑联系紧密，建议设置较大的重叠部分，如 50 - 100 个 token，以确保相邻文本片段之间的过渡自然，模型在处理时能够更好地理解上下文。</li>
<li><strong>数据冗余</strong>：然而，设置过大的重叠部分会增加数据的冗余度，可能导致处理时间增加和资源浪费。因此，需要在上下文连贯性和数据冗余之间进行平衡。一般来说，20 - 50 个 token 的重叠是比较常见的取值范围。</li>
<li><strong>模型处理能力</strong>：如果使用的模型对输入的敏感性较高，较小的重叠部分（如 20 - 30 个 token）可能就足够了，因为过多的重叠可能会引入不必要的干扰信息。但如果模型对上下文依赖较大，适当增加重叠部分（如 40 - 60 个 token）可能会提高模型的性能。</li>
</ol>
<p>例如，在处理一般性的文本资料，且使用的模型上下文窗口较大（如 4096 个 token）时，设置文本片段最大大小为 600 - 800 个 token，重叠部分为 30 - 50 个 token 可能是一个不错的选择。但最终的设置还需要通过实验和实际效果评估来确定，以找到最适合具体应用场景的参数值。</p>
<h2 id="十一、项目实战-在硅谷小智中实现RAG">十一、项目实战-在硅谷小智中实现RAG</h2>
<h3 id="1、创建-Bean对象">1、创建@Bean对象</h3>
<p>在xiaozhiAgentConfig中添加ContentRetriever</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">ContentRetriever <span class="title function_">contentRetrieverXiaozhi</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//使用FileSystemDocumentLoader读取指定目录下的知识库文档</span></span><br><span class="line">    <span class="comment">//并使用默认的文档解析器对文档进行解析</span></span><br><span class="line">    <span class="type">Document</span> <span class="variable">document1</span> <span class="operator">=</span> FileSystemDocumentLoader.loadDocument(<span class="string">&quot;E:/knowledge/医院信息.md&quot;</span>);</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document2</span> <span class="operator">=</span> FileSystemDocumentLoader.loadDocument(<span class="string">&quot;E:/knowledge/科室信息.md&quot;</span>);</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document3</span> <span class="operator">=</span> FileSystemDocumentLoader.loadDocument(<span class="string">&quot;E:/knowledge/神经内科.md&quot;</span>);</span><br><span class="line">    List&lt;Document&gt; documents = Arrays.asList(document1, document2, document3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用内存向量存储</span></span><br><span class="line">    InMemoryEmbeddingStore&lt;TextSegment&gt; embeddingStore = <span class="keyword">new</span> <span class="title class_">InMemoryEmbeddingStore</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//使用默认的文档分割器</span></span><br><span class="line">    EmbeddingStoreIngestor.ingest(documents, embeddingStore);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从嵌入存储（EmbeddingStore）里检索和查询内容相关的信息</span></span><br><span class="line">    <span class="keyword">return</span> EmbeddingStoreContentRetriever.from(embeddingStore);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2、添加配置">2、添加配置</h3>
<p>在<code>XiaozhiAgent</code>中添加<code>contentRetriever</code>配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AiService(</span></span><br><span class="line"><span class="meta">        wiringMode = EXPLICIT,</span></span><br><span class="line"><span class="meta">        chatModel = &quot;qwenChatModel&quot;,</span></span><br><span class="line"><span class="meta">        chatMemoryProvider = &quot;chatMemoryProviderXiaozhi&quot;,</span></span><br><span class="line"><span class="meta">        tools = &quot;appointmentTools&quot;,</span></span><br><span class="line"><span class="meta">        contentRetriever = &quot;contentRetrieverXiaozhi&quot; //配置向量存储</span></span><br><span class="line"><span class="meta">)</span></span><br></pre></td></tr></table></figure>
<h3 id="3、修改工具的value提示">3、修改工具的value提示</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tool(name=&quot;预约挂号&quot;, value = &quot;根据参数，先执行工具方法queryDepartment查询是否可预约，并直接给用户回答是否可预约，并让用户确认所有预约信息，用户确认后再进行预约。如果用户没有提供具体的医生姓名，请从向量存储中找到一位医生。&quot;)</span></span><br></pre></td></tr></table></figure>
<h3 id="4、测试RAG">4、测试RAG</h3>
<p>在Controller中测试</p>
<h2 id="十二、向量模型和向量存储">十二、向量模型和向量存储</h2>
<h3 id="1、向量大模型">1、向量大模型</h3>
<h4 id="1-1、介绍">1.1、介绍</h4>
<p>**通用文本向量模型：**<a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/model-studio/developer-reference/text-embedding-synchronous-api?spm=a2c4g.11186623.help-menu-2400256.d_2_5_0.592672a3yMJDRq&amp;scm=20140722.H_2712515._.OR_help-T_cn~zh-V_1">https://help.aliyun.com/zh/model-studio/developer-reference/text-embedding-synchronous-api?spm=a2c4g.11186623.help-menu-2400256.d_2_5_0.592672a3yMJDRq&amp;scm=20140722.H_2712515._.OR_help-T_cn~zh-V_1</a></p>
<p><strong>text-embedding-v3：</strong><a target="_blank" rel="noopener" href="https://bailian.console.aliyun.com/?tab=model#/model-market/detail/text-embedding-v3">阿里云百炼</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://photo.459122.xyz/i/14cf859abeb5de6588a758ff76e0bda0.png" alt="image-20250402000205052-1749129786013-11"></p>
<p>使用通用文本向量 text-embedding-v3，维度1024，维度越多，对事务的描述越精准，信息检索的精度越高</p>
<h4 id="1-2、模型配置">1.2、模型配置</h4>
<p>使用<code>text-embedding-v3</code>依然需要添加<code>langchain4j-community-dashscope</code>依赖，我们之前已经添加过了</p>
<p>配置向量模型</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#集成阿里通义千问-通用文本向量-v3</span></span><br><span class="line"><span class="attr">langchain4j.community.dashscope.embedding-model.api-key</span>=<span class="string">$&#123;DASH_SCOPE_API_KEY&#125;</span></span><br><span class="line"><span class="attr">langchain4j.community.dashscope.embedding-model.model-name</span>=<span class="string">text-embedding-v3</span></span><br></pre></td></tr></table></figure>
<h4 id="1-3、文本向量化">1.3、文本向量化</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmbeddingTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmbeddingModel embeddingModel;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testEmbeddingModel</span><span class="params">()</span>&#123;</span><br><span class="line">        Response&lt;Embedding&gt; embed = embeddingModel.embed(<span class="string">&quot;你好&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;向量维度：&quot;</span> + embed.content().vector().length);</span><br><span class="line">        System.out.println(<span class="string">&quot;向量输出：&quot;</span> + embed.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2、向量存储">2、向量存储</h3>
<h4 id="2-1、Pinecone简介">2.1、Pinecone简介</h4>
<p>之前我们使用的是InMemoryEmbeddingStore作为向量存储，但是不建议在生产中使用基于内存的向量存储。因此这里我们使用Pinecone作为向量数据库。</p>
<p>官方网站：<a target="_blank" rel="noopener" href="https://www.pinecone.io/">The vector database to build knowledgeable AI | Pinecone</a></p>
<p>访问官方网站、注册、登录、获取apiKey且配置在环境变量中。<strong>默认有2GB的免费存储空间</strong></p>
<h4 id="2-2、Pinecone的使用">2.2、Pinecone的使用</h4>
<p><strong>得分的含义</strong></p>
<p>在向量检索场景中，当我们把查询文本转换为向量后，会在嵌入存储（<code>EmbeddingStore</code>）里查找与之最相似的向量（这些向量对应着文档片段等内容）。为了衡量查询向量和存储向量之间的相似程度，会使用某种相似度计算方法（例如余弦相似度等）来得出一个数值，这个数值就是得分。得分越高，表明查询向量和存储向量越相似，对应的文档片段与查询文本的相关性也就越高。</p>
<p><strong>得分的作用</strong></p>
<ul>
<li><strong>筛选结果</strong>：通过设置 <code>minScore</code> 阈值，能够过滤掉那些与查询文本相关性较低的结果。在代码里，<code>minScore(0.8)</code> 意味着只有得分大于等于 0.8 的结果才会被返回，低于这个阈值的结果会被舍弃。这样可以确保返回的结果是与查询文本高度相关的，提升检索结果的质量。</li>
<li><strong>控制召回率和准确率</strong>：调整 <code>minScore</code> 的值可以在召回率和准确率之间进行权衡。如果把阈值设置得较低，那么更多的结果会被返回，召回率会提高，但可能会包含一些相关性不太强的结果，导致准确率下降；反之，如果把阈值设置得较高，返回的结果数量会减少，准确率会提高，但可能会遗漏一些相关的结果，使得召回率降低。在实际应用中，需要根据具体的业务需求来合理设置 <code>minScore</code> 的值。</li>
</ul>
<p><strong>示例说明</strong></p>
<p>假设我们有一个关于水果的文档集合，嵌入存储中存储了这些文档片段的向量。当我们使用 “苹果的营养价值” 作为查询文本时，向量检索会计算查询向量与存储向量的相似度得分。如果 <code>minScore</code> 设置为 0.8，那么只有那些与 “苹果的营养价值” 相关性非常高的文档片段才会被返回，而一些只简单提及苹果但没有详细讨论其营养价值的文档片段可能由于得分低于 0.8 而不会被返回。</p>
<h4 id="2-3、集成Pinecone">2.3、集成Pinecone</h4>
<p>参考文档：<a target="_blank" rel="noopener" href="https://docs.langchain4j.dev/integrations/embedding-stores/pinecone">Pinecone | LangChain4j</a></p>
<p>添加依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-pinecone<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-4、配置向量存储对象">2.4、配置向量存储对象</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java.ai.langchain4j.config;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmbeddingStoreConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmbeddingModel embeddingModel;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> EmbeddingStore&lt;TextSegment&gt; <span class="title function_">embeddingStore</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//创建向量存储</span></span><br><span class="line">        EmbeddingStore&lt;TextSegment&gt; embeddingStore = PineconeEmbeddingStore.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;PINECONE_API_KEY&quot;</span>))</span><br><span class="line">                .index(<span class="string">&quot;xiaozhi-index&quot;</span>)<span class="comment">//如果指定的索引不存在，将创建一个新的索引</span></span><br><span class="line">                .nameSpace(<span class="string">&quot;xiaozhi-namespace&quot;</span>) <span class="comment">//如果指定的名称空间不存在，将创建一个新的名称空间</span></span><br><span class="line">                .createIndex(PineconeServerlessIndexConfig.builder()</span><br><span class="line">                        .cloud(<span class="string">&quot;AWS&quot;</span>) <span class="comment">//指定索引部署在 AWS 云服务上。</span></span><br><span class="line">                        .region(<span class="string">&quot;us-east-1&quot;</span>) <span class="comment">//指定索引所在的 AWS 区域为 us-east-1。</span></span><br><span class="line">                        .dimension(embeddingModel.dimension()) <span class="comment">//指定索引的向量维度，该维度与 embeddedModel 生成的向量维度相同。</span></span><br><span class="line">                        .build())</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> embeddingStore;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-5、测试向量存储">2.5、测试向量存储</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> EmbeddingStore embeddingStore;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将文本转换成向量，然后存储到pinecone中</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 参考：</span></span><br><span class="line"><span class="comment"> * https://docs.langchain4j.dev/tutorials/embedding-stores</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPineconeEmbeded</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将文本转换成向量</span></span><br><span class="line">    <span class="type">TextSegment</span> <span class="variable">segment1</span> <span class="operator">=</span> TextSegment.from(<span class="string">&quot;我喜欢羽毛球&quot;</span>);</span><br><span class="line">    <span class="type">Embedding</span> <span class="variable">embedding1</span> <span class="operator">=</span> embeddingModel.embed(segment1).content();</span><br><span class="line">    <span class="comment">//存入向量数据库</span></span><br><span class="line">    embeddingStore.add(embedding1, segment1);</span><br><span class="line"></span><br><span class="line">    <span class="type">TextSegment</span> <span class="variable">segment2</span> <span class="operator">=</span> TextSegment.from(<span class="string">&quot;今天天气很好&quot;</span>);</span><br><span class="line">    <span class="type">Embedding</span> <span class="variable">embedding2</span> <span class="operator">=</span> embeddingModel.embed(segment2).content();</span><br><span class="line">    embeddingStore.add(embedding2, segment2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3、相似度匹配">3、相似度匹配</h3>
<p>接收请求获取问题，将问题转换为向量，在 Pinecone 向量数据库中进行相似度搜索，找到最相似的文本片段，并将其文本内容返回给客户端。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Pinecone-相似度匹配</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">embeddingSearch</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//提问，并将问题转成向量数据</span></span><br><span class="line">    <span class="type">Embedding</span> <span class="variable">queryEmbedding</span> <span class="operator">=</span> embeddingModel.embed(<span class="string">&quot;你最喜欢的运动是什么？&quot;</span>).content();</span><br><span class="line">    <span class="comment">//创建搜索请求对象</span></span><br><span class="line">    <span class="type">EmbeddingSearchRequest</span> <span class="variable">searchRequest</span> <span class="operator">=</span> EmbeddingSearchRequest.builder()</span><br><span class="line">            .queryEmbedding(queryEmbedding)</span><br><span class="line">            .maxResults(<span class="number">1</span>) <span class="comment">//匹配最相似的一条记录</span></span><br><span class="line">        	<span class="comment">//.minScore(0.8)</span></span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据搜索请求 searchRequest 在向量存储中进行相似度搜索</span></span><br><span class="line">    EmbeddingSearchResult&lt;TextSegment&gt; searchResult = embeddingStore.search(searchRequest);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//searchResult.matches()：获取搜索结果中的匹配项列表。</span></span><br><span class="line">    <span class="comment">//.get(0)：从匹配项列表中获取第一个匹配项</span></span><br><span class="line">    EmbeddingMatch&lt;TextSegment&gt; embeddingMatch = searchResult.matches().get(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取匹配项的相似度得分</span></span><br><span class="line">    System.out.println(embeddingMatch.score()); <span class="comment">// 0.8144288515898701</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回文本结果</span></span><br><span class="line">    System.out.println(embeddingMatch.embedded().text());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="十三、项目实战-在硅谷小智中整合向量数据库">十三、项目实战-在硅谷小智中整合向量数据库</h2>
<h3 id="1、上传知识库到Pinecone">1、上传知识库到Pinecone</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUploadKnowledgeLibrary</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用FileSystemDocumentLoader读取指定目录下的知识库文档</span></span><br><span class="line">    <span class="comment">//并使用默认的文档解析器对文档进行解析</span></span><br><span class="line">    <span class="type">Document</span> <span class="variable">document1</span> <span class="operator">=</span> FileSystemDocumentLoader.loadDocument(<span class="string">&quot;E:/knowledge/医院信息.md&quot;</span>);</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document2</span> <span class="operator">=</span> FileSystemDocumentLoader.loadDocument(<span class="string">&quot;E:/knowledge/科室信息.md&quot;</span>);</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document3</span> <span class="operator">=</span> FileSystemDocumentLoader.loadDocument(<span class="string">&quot;E:/knowledge/神经内科.md&quot;</span>);</span><br><span class="line">    List&lt;Document&gt; documents = Arrays.asList(document1, document2, document3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//文本向量化并存入向量数据库：将每个片段进行向量化，得到一个嵌入向量</span></span><br><span class="line">    EmbeddingStoreIngestor</span><br><span class="line">            .builder()</span><br><span class="line">            .embeddingStore(embeddingStore)</span><br><span class="line">            .embeddingModel(embeddingModel)</span><br><span class="line">            .build()</span><br><span class="line">            .ingest(documents);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2、修改XiaozhiAgentConfig">2、修改XiaozhiAgentConfig</h3>
<p>添加基于Pinecone的向量数据库配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> EmbeddingStore embeddingStore;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> EmbeddingModel embeddingModel;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line">ContentRetriever <span class="title function_">contentRetrieverXiaozhiPincone</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个 EmbeddingStoreContentRetriever 对象，用于从嵌入存储中检索内容</span></span><br><span class="line">    <span class="keyword">return</span> EmbeddingStoreContentRetriever</span><br><span class="line">            .builder()</span><br><span class="line">            <span class="comment">// 设置用于生成嵌入向量的嵌入模型</span></span><br><span class="line">            .embeddingModel(embeddingModel)</span><br><span class="line">            <span class="comment">// 指定要使用的嵌入存储</span></span><br><span class="line">            .embeddingStore(embeddingStore)</span><br><span class="line">            <span class="comment">// 设置最大检索结果数量，这里表示最多返回 1 条匹配结果</span></span><br><span class="line">            .maxResults(<span class="number">1</span>)</span><br><span class="line">            <span class="comment">// 设置最小得分阈值，只有得分大于等于 0.8 的结果才会被返回</span></span><br><span class="line">            .minScore(<span class="number">0.8</span>)</span><br><span class="line">            <span class="comment">// 构建最终的 EmbeddingStoreContentRetriever 实例</span></span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3、修改XiaozhiAgent">3、修改XiaozhiAgent</h3>
<p>修改contentRetriever的配置为contentRetrieverXiaozhiPincone</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AiService(</span></span><br><span class="line"><span class="meta">        wiringMode = EXPLICIT,</span></span><br><span class="line"><span class="meta">        chatModel = &quot;qwenChatModel&quot;,</span></span><br><span class="line"><span class="meta">        chatMemoryProvider = &quot;chatMemoryProviderXiaozhi&quot;,</span></span><br><span class="line"><span class="meta">        tools = &quot;appointmentTools&quot;,</span></span><br><span class="line"><span class="meta">        contentRetriever = &quot;contentRetrieverXiaozhiPincone&quot;)</span></span><br></pre></td></tr></table></figure>
<h2 id="十四、项目实战-改造流式输出">十四、项目实战-改造流式输出</h2>
<p>大模型的流式输出是指大模型在生成文本或其他类型的数据时，不是等到整个生成过程完成后再一次性返回所有内容，而是生成一部分就立即发送一部分给用户或下游系统，以逐步、逐块的方式返回结果。这样，用户就不需要等待整个文本生成完成再看到结果。通过这种方式可以改善用户体验，因为用户不需要等待太长时间，几乎可以立即开始阅读响应。</p>
<h3 id="1、添加依赖">1、添加依赖</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--流式输出--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-reactor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2、配置流式输出模型">2、配置流式输出模型</h3>
<p>在application.properties中配置流式输出大模型</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#集成阿里通义千问-流式输出</span></span><br><span class="line"><span class="attr">langchain4j.community.dashscope.streaming-chat-model.api-key</span>=<span class="string">$&#123;DASH_SCOPE_API_KEY&#125;</span></span><br><span class="line"><span class="attr">langchain4j.community.dashscope.streaming-chat-model.model-name</span>=<span class="string">qwen-plus</span></span><br></pre></td></tr></table></figure>
<h3 id="3、编码">3、编码</h3>
<p>修改<code>XiaozhiAgent</code>中<code>chatModel</code>改为 streamingChatModel = “qwenStreamingChatModel”</p>
<p>``chat<code>方法的返回值为</code>Flux<String>`</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AiService(</span></span><br><span class="line"><span class="meta">        wiringMode = EXPLICIT,</span></span><br><span class="line"><span class="meta">        streamingChatModel = &quot;qwenStreamingChatModel&quot;,</span></span><br><span class="line"><span class="meta">        chatMemoryProvider = &quot;chatMemoryProviderXiaozhi&quot;,</span></span><br><span class="line"><span class="meta">        tools = &quot;appointmentTools&quot;,</span></span><br><span class="line"><span class="meta">        contentRetriever = &quot;contentRetrieverXiaozhiPincone&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">XiaozhiAgent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SystemMessage(fromResource = &quot;zhaozhi-prompt-template.txt&quot;)</span></span><br><span class="line">    Flux&lt;String&gt; <span class="title function_">chat</span><span class="params">(<span class="meta">@MemoryId</span> Long memoryId, <span class="meta">@UserMessage</span> String userMessage)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改<code>XiaozhiController</code>中<code>chat</code>方法的返回值为<code>Flux&lt;String&gt;</code>，并添加<code>produces</code>属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;对话&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(value = &quot;/chat&quot;, produces = &quot;text/stream;charset=utf-8&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">chat</span><span class="params">(<span class="meta">@RequestBody</span> ChatForm chatForm)</span>  &#123;</span><br><span class="line">    <span class="keyword">return</span> xiaozhiAgent.chat(chatForm.getMemoryId(), chatForm.getMessage());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3、测试">3、测试</h3>
<h2 id="十五、项目实战-运行前端工程">十五、项目实战-运行前端工程</h2>
<h3 id="1、安装Node-js">1、安装Node.js</h3>
<p>Node.js是一个基于JavaScript引擎的服务器端环境，前端项目在开发环境下要基于Node.js来运行</p>
<p>安装：node-v18.17.1-x64.msi</p>
<h3 id="2、配置npm镜像">2、配置npm镜像</h3>
<p>打开命令行，配置依赖的下载使用阿里镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> registry https://registry.npmmirror.com</span><br></pre></td></tr></table></figure>
<h3 id="3、运行前端项目">3、运行前端项目</h3>
<p>进入项目目录，执行下面的命令启动项目：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> xiaozhi<span class="literal">-ui</span></span><br><span class="line">npm i</span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>Langchain4j</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://yjyrichard.github.io/posts/2ffe06be.html">https://yjyrichard.github.io/posts/2ffe06be.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>Yangjiayu</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2025-06-05</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2025-06-08</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>java</a></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">投喂作者</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://bilibili123.oss-cn-beijing.aliyuncs.com/about/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bilibili123.oss-cn-beijing.aliyuncs.com/about/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://bilibili123.oss-cn-beijing.aliyuncs.com/about/%E6%94%AF%E4%BB%98%E5%AE%9D.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bilibili123.oss-cn-beijing.aliyuncs.com/about/%E6%94%AF%E4%BB%98%E5%AE%9D.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></button></div><audio id="coinAudio" src="https://npm.elemecdn.com/akilar-candyassets@1.0.36/audio/aowu.m4a"></audio><script defer="defer" src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/3d614825.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bilibili123.oss-cn-beijing.aliyuncs.com/websitepic/10.png" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">HashMap</div></div></a></div><div class="next-post pull-right"><a href="/posts/b5c6903b.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bilibili123.oss-cn-beijing.aliyuncs.com/websitepic/4.png" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">英语学习01-名词</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/52427a31.html" title="哈希表刷题"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bilibili123.oss-cn-beijing.aliyuncs.com/websitepic/9.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-04-15</div><div class="title">哈希表刷题</div></div></a></div><div><a href="/posts/f73611c8.html" title="ThreadLocal全面解析"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bilibili123.oss-cn-beijing.aliyuncs.com/websitepic/2.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-04-15</div><div class="title">ThreadLocal全面解析</div></div></a></div><div><a href="/posts/a70f4376.html" title="注解"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bilibili123.oss-cn-beijing.aliyuncs.com/websitepic/7.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-04-15</div><div class="title">注解</div></div></a></div><div><a href="/posts/6ce37b73.html" title="设计模式（2）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bilibili123.oss-cn-beijing.aliyuncs.com/websitepic/9.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-05-05</div><div class="title">设计模式（2）</div></div></a></div><div><a href="/posts/7af799fd.html" title="反射"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bilibili123.oss-cn-beijing.aliyuncs.com/websitepic/13.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-04-15</div><div class="title">反射</div></div></a></div><div><a href="/posts/3d614825.html" title="HashMap"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bilibili123.oss-cn-beijing.aliyuncs.com/websitepic/10.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-06-08</div><div class="title">HashMap</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><svg class="meta_icon" style="width:22px;height:22px;position:relative;top:5px"><use xlink:href="#icon-mulu1"></use></svg><span style="font-weight:bold">目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">Langchain4j</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-text">前置知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81LangChain4j-%E5%85%A5%E9%97%A8"><span class="toc-text">一、LangChain4j 入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%AE%80%E4%BB%8B"><span class="toc-text">1、简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%E3%80%81%E5%8E%86%E5%8F%B2%E8%83%8C%E6%99%AF"><span class="toc-text">1.1、历史背景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%E3%80%81%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="toc-text">1.2、主要功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3%E3%80%81%E5%BA%94%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-text">1.3、应用示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%88%9B%E5%BB%BASpringBoot%E9%A1%B9%E7%9B%AE"><span class="toc-text">2、创建SpringBoot项目</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%E3%80%81%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAMaven%E9%A1%B9%E7%9B%AE"><span class="toc-text">2.1、创建一个Maven项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%E3%80%81%E6%B7%BB%E5%8A%A0SpringBoot%E7%9B%B8%E5%85%B3%E4%BE%9D%E8%B5%96"><span class="toc-text">2.2、添加SpringBoot相关依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%E3%80%81%E5%88%9B%E5%BB%BA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">2.3、创建配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4%E3%80%81%E5%88%9B%E5%BB%BA%E5%90%AF%E5%8A%A8%E7%B1%BB"><span class="toc-text">2.4、创建启动类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5%E3%80%81%E5%90%AF%E5%8A%A8%E5%90%AF%E5%8A%A8%E7%B1%BB"><span class="toc-text">2.5、启动启动类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%8E%A5%E5%85%A5%E5%A4%A7%E6%A8%A1%E5%9E%8B"><span class="toc-text">3、接入大模型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%E3%80%81LangChain4j-%E5%BA%93%E7%BB%93%E6%9E%84"><span class="toc-text">3.1、LangChain4j 库结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2%E3%80%81%E6%B7%BB%E5%8A%A0LangChain4j%E7%9B%B8%E5%85%B3%E4%BE%9D%E8%B5%96"><span class="toc-text">3.2、添加LangChain4j相关依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3%E3%80%81%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B"><span class="toc-text">3.3、创建测试用例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81SpringBoot%E6%95%B4%E5%90%88"><span class="toc-text">4、SpringBoot整合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1%E3%80%81%E6%9B%BF%E6%8D%A2%E4%BE%9D%E8%B5%96"><span class="toc-text">4.1、替换依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2%E3%80%81%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0"><span class="toc-text">4.2、配置模型参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3%E3%80%81%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B"><span class="toc-text">4.3、创建测试用例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%8E%A5%E5%85%A5%E5%85%B6%E4%BB%96%E5%A4%A7%E6%A8%A1%E5%9E%8B"><span class="toc-text">二、接入其他大模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E5%A4%A7%E6%A8%A1%E5%9E%8B"><span class="toc-text">1、都有哪些大模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%8E%A5%E5%85%A5DeepSeek"><span class="toc-text">2、接入DeepSeek</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%E3%80%81%E8%8E%B7%E5%8F%96%E5%BC%80%E5%8F%91%E5%8F%82%E6%95%B0"><span class="toc-text">1.1、获取开发参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%E3%80%81%E9%85%8D%E7%BD%AE%E5%BC%80%E5%8F%91%E5%8F%82%E6%95%B0"><span class="toc-text">1.2、配置开发参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3%E3%80%81%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0"><span class="toc-text">1.3、配置模型参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-text">1.4、测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81ollama%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2"><span class="toc-text">3、ollama本地部署</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2"><span class="toc-text">3.1、为什么要本地部署</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2%E3%80%81%E5%9C%A8ollama%E4%B8%8A%E9%83%A8%E7%BD%B2DeepSeek"><span class="toc-text">3.2、在ollama上部署DeepSeek</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3%E3%80%81%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-text">3.3、常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4%E3%80%81%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-text">3.4、引入依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5%E3%80%81%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0"><span class="toc-text">3.5、配置模型参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6%E3%80%81%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B"><span class="toc-text">3.6、创建测试用例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%8E%A5%E5%85%A5%E9%98%BF%E9%87%8C%E7%99%BE%E7%82%BC%E5%B9%B3%E5%8F%B0"><span class="toc-text">4、接入阿里百炼平台</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E9%98%BF%E9%87%8C%E7%99%BE%E7%82%BC"><span class="toc-text">4.1、什么是阿里百炼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2%E3%80%81%E7%94%B3%E8%AF%B7%E5%85%8D%E8%B4%B9%E4%BD%93%E9%AA%8C"><span class="toc-text">4.2、申请免费体验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3%E3%80%81%E9%85%8D%E7%BD%AEapiKey"><span class="toc-text">4.3、配置apiKey</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4%E3%80%81%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="toc-text">4.4、添加依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5%E3%80%81%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0"><span class="toc-text">4.5、配置模型参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-6%E3%80%81%E6%B5%8B%E8%AF%95%E9%80%9A%E4%B9%89%E5%8D%83%E9%97%AE"><span class="toc-text">4.6、测试通义千问</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-6%E3%80%81%E6%B5%8B%E8%AF%95%E9%80%9A%E4%B9%89%E4%B8%87%E8%B1%A1"><span class="toc-text">4.6、测试通义万象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-7%E3%80%81%E6%B5%8B%E8%AF%95DeepSeek"><span class="toc-text">4.7、测试DeepSeek</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E6%9C%8D%E5%8A%A1-AIService"><span class="toc-text">三、人工智能服务 AIService</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFAIService"><span class="toc-text">1、什么是AIService</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%E3%80%81%E9%93%BE-Chain%EF%BC%88%E6%97%A7%E7%89%88%EF%BC%89"><span class="toc-text">1.1、链 Chain（旧版）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%E3%80%81%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E6%9C%8D%E5%8A%A1-AIService"><span class="toc-text">1.2、人工智能服务 AIService</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%88%9B%E5%BB%BAAIService"><span class="toc-text">2、创建AIService</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%E3%80%81%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-text">2.1、引入依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%E3%80%81%E5%88%9B%E5%BB%BA%E6%8E%A5%E5%8F%A3"><span class="toc-text">2.2、创建接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%E3%80%81%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B"><span class="toc-text">2.3、测试用例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4%E3%80%81-AiService"><span class="toc-text">2.4、@AiService</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5%E3%80%81%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">2.5、工作原理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BF%86-Chat-memory"><span class="toc-text">四、聊天记忆 Chat memory</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%B5%8B%E8%AF%95%E5%AF%B9%E8%AF%9D%E6%98%AF%E5%90%A6%E6%9C%89%E8%AE%B0%E5%BF%86"><span class="toc-text">1、测试对话是否有记忆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BF%86%E7%9A%84%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0"><span class="toc-text">2、聊天记忆的简单实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%BD%BF%E7%94%A8ChatMemory%E5%AE%9E%E7%8E%B0%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BF%86"><span class="toc-text">3、使用ChatMemory实现聊天记忆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E4%BD%BF%E7%94%A8AIService%E5%AE%9E%E7%8E%B0%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BF%86"><span class="toc-text">4、使用AIService实现聊天记忆</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1%E3%80%81%E5%88%9B%E5%BB%BA%E8%AE%B0%E5%BF%86%E5%AF%B9%E8%AF%9D%E6%99%BA%E8%83%BD%E4%BD%93"><span class="toc-text">4.1、创建记忆对话智能体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2%E3%80%81%E9%85%8D%E7%BD%AEChatMemory"><span class="toc-text">4.2、配置ChatMemory</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-text">4.3、测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E9%9A%94%E7%A6%BB%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BF%86"><span class="toc-text">5、隔离聊天记忆</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1%E3%80%81%E5%88%9B%E5%BB%BA%E8%AE%B0%E5%BF%86%E9%9A%94%E7%A6%BB%E5%AF%B9%E8%AF%9D%E6%99%BA%E8%83%BD%E4%BD%93"><span class="toc-text">5.1、创建记忆隔离对话智能体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2%E3%80%81%E9%85%8D%E7%BD%AEChatMemoryProvider"><span class="toc-text">5.2、配置ChatMemoryProvider</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3%E3%80%81%E6%B5%8B%E8%AF%95%E5%AF%B9%E8%AF%9D%E5%8A%A9%E6%89%8B"><span class="toc-text">5.3、测试对话助手</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%8C%81%E4%B9%85%E5%8C%96%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BF%86-Persistence"><span class="toc-text">五、持久化聊天记忆 Persistence</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%AD%98%E5%82%A8%E4%BB%8B%E8%B4%A8%E7%9A%84%E9%80%89%E6%8B%A9"><span class="toc-text">1、存储介质的选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81MongoDB"><span class="toc-text">2、MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%E3%80%81%E7%AE%80%E4%BB%8B"><span class="toc-text">2.1、简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%E3%80%81%E5%AE%89%E8%A3%85MongoDB"><span class="toc-text">2.2、安装MongoDB</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%E3%80%81%E4%BD%BF%E7%94%A8mongosh"><span class="toc-text">2.3、使用mongosh</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4%E3%80%81%E4%BD%BF%E7%94%A8mongodb-compass"><span class="toc-text">2.4、使用mongodb-compass</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5%E3%80%81%E6%95%B4%E5%90%88SpringBoot"><span class="toc-text">2.5、整合SpringBoot</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6%E3%80%81CRUD%E6%B5%8B%E8%AF%95"><span class="toc-text">2.6、CRUD测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%8C%81%E4%B9%85%E5%8C%96%E8%81%8A%E5%A4%A9"><span class="toc-text">3、持久化聊天</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%E3%80%81%E4%BC%98%E5%8C%96%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-text">3.1、优化实体类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2%E3%80%81%E5%88%9B%E5%BB%BA%E6%8C%81%E4%B9%85%E5%8C%96%E7%B1%BB"><span class="toc-text">3.2、创建持久化类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-text">4、测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%8F%90%E7%A4%BA%E8%AF%8D-Prompt"><span class="toc-text">六、提示词 Prompt</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%B3%BB%E7%BB%9F%E6%8F%90%E7%A4%BA%E8%AF%8D"><span class="toc-text">1、系统提示词</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%E3%80%81%E9%85%8D%E7%BD%AE-SystemMessage"><span class="toc-text">1.1、配置@SystemMessage</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-text">1.2、测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3%E3%80%81%E4%BB%8E%E8%B5%84%E6%BA%90%E4%B8%AD%E5%8A%A0%E8%BD%BD%E6%8F%90%E7%A4%BA%E6%A8%A1%E6%9D%BF"><span class="toc-text">1.3、从资源中加载提示模板</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%94%A8%E6%88%B7%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%A8%A1%E6%9D%BF"><span class="toc-text">2、用户提示词模板</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%E3%80%81%E9%85%8D%E7%BD%AE-UserMessage"><span class="toc-text">2.1、配置@UserMessage</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-text">2.2、测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%8C%87%E5%AE%9A%E5%8F%82%E6%95%B0%E5%90%8D%E7%A7%B0"><span class="toc-text">3、指定参数名称</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%E3%80%81%E9%85%8D%E7%BD%AE-V"><span class="toc-text">3.1、配置@V</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2%E3%80%81%E5%A4%9A%E4%B8%AA%E5%8F%82%E6%95%B0%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-text">3.2、多个参数的情况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3%E3%80%81-SystemMessage%E5%92%8C-V"><span class="toc-text">3.3、@SystemMessage和@V</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98-%E5%88%9B%E5%BB%BA%E7%A1%85%E8%B0%B7%E5%B0%8F%E6%99%BA"><span class="toc-text">七、项目实战-创建硅谷小智</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BA%E7%A1%85%E8%B0%B7%E5%B0%8F%E6%99%BA"><span class="toc-text">1、创建硅谷小智</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%A8%A1%E6%9D%BF"><span class="toc-text">2、提示词模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E9%85%8D%E7%BD%AE%E5%B0%8F%E6%99%BA%E5%8A%A9%E6%89%8B"><span class="toc-text">3、配置小智助手</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%B0%81%E8%A3%85%E5%AF%B9%E8%AF%9D%E5%AF%B9%E8%B1%A1"><span class="toc-text">4、封装对话对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E6%B7%BB%E5%8A%A0Controller%E6%96%B9%E6%B3%95"><span class="toc-text">5、添加Controller方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E5%BE%85%E4%BC%98%E5%8C%96"><span class="toc-text">6、待优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81-Function-Calling-%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="toc-text">八、 Function Calling 函数调用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="toc-text">1、入门案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%E3%80%81%E5%88%9B%E5%BB%BA%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-text">1.1、创建工具类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%E3%80%81%E9%85%8D%E5%80%BC%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-text">1.2、配值工具类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3%E3%80%81%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-text">1.3、测试工具类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81-Tool-%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%8F%AF%E9%80%89%E5%AD%97%E6%AE%B5"><span class="toc-text">2、@Tool 注解的可选字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81-P-%E6%B3%A8%E8%A7%A3"><span class="toc-text">3、@P 注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81-ToolMemoryId"><span class="toc-text">4、@ToolMemoryId</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98-%E4%BC%98%E5%8C%96%E7%A1%85%E8%B0%B7%E5%B0%8F%E6%99%BA"><span class="toc-text">九、项目实战-优化硅谷小智</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E9%A2%84%E7%BA%A6%E4%B8%9A%E5%8A%A1%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-text">1、预约业务的实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%E3%80%81%E5%88%9B%E5%BB%BAMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8"><span class="toc-text">1.1、创建MySQL数据库表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%E3%80%81%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-text">1.2、引入依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3%E3%80%81%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5"><span class="toc-text">1.3、配置数据库连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4%E3%80%81%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-text">1.4、创建实体类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5%E3%80%81Mapper"><span class="toc-text">1.5、Mapper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6%E3%80%81Service"><span class="toc-text">1.6、Service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-7%E3%80%81%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B"><span class="toc-text">1.7、创建测试用例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81Tools"><span class="toc-text">2、Tools</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%E3%80%81%E5%88%9B%E5%BB%BATools"><span class="toc-text">2.1、创建Tools</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%E3%80%81%E9%85%8D%E7%BD%AETools"><span class="toc-text">2.2、配置Tools</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-text">2.3、测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E6%A3%80%E7%B4%A2%E5%A2%9E%E5%BC%BA%E7%94%9F%E6%88%90-RAG"><span class="toc-text">十、检索增强生成 RAG</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%9B%9E%E7%AD%94%E4%B8%93%E4%B8%9A%E9%A2%86%E5%9F%9F%E7%9A%84%E7%9F%A5%E8%AF%86"><span class="toc-text">1、如何让大模型回答专业领域的知识</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%E3%80%81%E5%BE%AE%E8%B0%83%E5%A4%A7%E6%A8%A1%E5%9E%8B"><span class="toc-text">1.1、微调大模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%E3%80%81RAG"><span class="toc-text">1.2、RAG</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3%E3%80%81RAG%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text">1.3、RAG常用方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%90%91%E9%87%8F%E6%90%9C%E7%B4%A2-vector-search"><span class="toc-text">2、向量搜索 vector search</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%E3%80%81%E5%90%91%E9%87%8F-Vectors"><span class="toc-text">2.1、向量 Vectors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%E3%80%81%E7%BB%B4%E5%BA%A6-Dimensions"><span class="toc-text">2.2、维度 Dimensions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%E3%80%81%E7%9B%B8%E4%BC%BC%E5%BA%A6-Similarity"><span class="toc-text">2.3、相似度 Similarity</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4%E3%80%81%E7%9B%B8%E4%BC%BC%E5%BA%A6%E6%B5%8B%E9%87%8F-Measures-of-similarity"><span class="toc-text">2.4、相似度测量 Measures of similarity</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81RAG%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="toc-text">3、RAG的过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%E3%80%81%E7%B4%A2%E5%BC%95%E9%98%B6%E6%AE%B5"><span class="toc-text">3.1、索引阶段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2%E3%80%81%E6%A3%80%E7%B4%A2%E9%98%B6%E6%AE%B5"><span class="toc-text">3.2、检索阶段</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%96%87%E6%A1%A3%E5%8A%A0%E8%BD%BD%E5%99%A8-Document-Loader"><span class="toc-text">4、文档加载器 Document Loader</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1%E3%80%81%E5%B8%B8%E8%A7%81%E6%96%87%E6%A1%A3%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-text">4.1、常见文档加载器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2%E3%80%81%E6%B5%8B%E8%AF%95%E6%96%87%E6%A1%A3%E5%8A%A0%E8%BD%BD"><span class="toc-text">4.2、测试文档加载</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E6%96%87%E6%A1%A3%E8%A7%A3%E6%9E%90%E5%99%A8-Document-Parser"><span class="toc-text">5、文档解析器 Document Parser</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1%E3%80%81%E5%B8%B8%E8%A7%81%E6%96%87%E6%A1%A3%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="toc-text">5.1、常见文档解析器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2%E3%80%81%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="toc-text">5.2、添加依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3%E3%80%81%E8%A7%A3%E6%9E%90pdf%E6%96%87%E6%A1%A3"><span class="toc-text">5.3、解析pdf文档</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E6%96%87%E6%A1%A3%E5%88%86%E5%89%B2%E5%99%A8-Document-Splitter"><span class="toc-text">6、文档分割器 Document Splitter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%E3%80%81%E5%B8%B8%E8%A7%81%E6%96%87%E6%A1%A3%E5%88%86%E5%89%B2%E5%99%A8"><span class="toc-text">6.1、常见文档分割器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2%E3%80%81%E6%B5%8B%E8%AF%95%E5%90%91%E9%87%8F%E8%BD%AC%E6%8D%A2%E5%92%8C%E5%90%91%E9%87%8F%E5%AD%98%E5%82%A8"><span class="toc-text">6.2、测试向量转换和向量存储</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3%E3%80%81%E6%B5%8B%E8%AF%95%E6%96%87%E6%A1%A3%E5%88%86%E5%89%B2"><span class="toc-text">6.3、测试文档分割</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4%E3%80%81token%E5%92%8Ctoken%E8%AE%A1%E7%AE%97"><span class="toc-text">6.4、token和token计算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-5%E3%80%81%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F"><span class="toc-text">6.5、工作方式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98-%E5%9C%A8%E7%A1%85%E8%B0%B7%E5%B0%8F%E6%99%BA%E4%B8%AD%E5%AE%9E%E7%8E%B0RAG"><span class="toc-text">十一、项目实战-在硅谷小智中实现RAG</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BA-Bean%E5%AF%B9%E8%B1%A1"><span class="toc-text">1、创建@Bean对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE"><span class="toc-text">2、添加配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%BF%AE%E6%94%B9%E5%B7%A5%E5%85%B7%E7%9A%84value%E6%8F%90%E7%A4%BA"><span class="toc-text">3、修改工具的value提示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%B5%8B%E8%AF%95RAG"><span class="toc-text">4、测试RAG</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81%E5%90%91%E9%87%8F%E6%A8%A1%E5%9E%8B%E5%92%8C%E5%90%91%E9%87%8F%E5%AD%98%E5%82%A8"><span class="toc-text">十二、向量模型和向量存储</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%90%91%E9%87%8F%E5%A4%A7%E6%A8%A1%E5%9E%8B"><span class="toc-text">1、向量大模型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%E3%80%81%E4%BB%8B%E7%BB%8D"><span class="toc-text">1.1、介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%E3%80%81%E6%A8%A1%E5%9E%8B%E9%85%8D%E7%BD%AE"><span class="toc-text">1.2、模型配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3%E3%80%81%E6%96%87%E6%9C%AC%E5%90%91%E9%87%8F%E5%8C%96"><span class="toc-text">1.3、文本向量化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%90%91%E9%87%8F%E5%AD%98%E5%82%A8"><span class="toc-text">2、向量存储</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%E3%80%81Pinecone%E7%AE%80%E4%BB%8B"><span class="toc-text">2.1、Pinecone简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%E3%80%81Pinecone%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">2.2、Pinecone的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%E3%80%81%E9%9B%86%E6%88%90Pinecone"><span class="toc-text">2.3、集成Pinecone</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4%E3%80%81%E9%85%8D%E7%BD%AE%E5%90%91%E9%87%8F%E5%AD%98%E5%82%A8%E5%AF%B9%E8%B1%A1"><span class="toc-text">2.4、配置向量存储对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5%E3%80%81%E6%B5%8B%E8%AF%95%E5%90%91%E9%87%8F%E5%AD%98%E5%82%A8"><span class="toc-text">2.5、测试向量存储</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E7%9B%B8%E4%BC%BC%E5%BA%A6%E5%8C%B9%E9%85%8D"><span class="toc-text">3、相似度匹配</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%89%E3%80%81%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98-%E5%9C%A8%E7%A1%85%E8%B0%B7%E5%B0%8F%E6%99%BA%E4%B8%AD%E6%95%B4%E5%90%88%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">十三、项目实战-在硅谷小智中整合向量数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%B8%8A%E4%BC%A0%E7%9F%A5%E8%AF%86%E5%BA%93%E5%88%B0Pinecone"><span class="toc-text">1、上传知识库到Pinecone</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%BF%AE%E6%94%B9XiaozhiAgentConfig"><span class="toc-text">2、修改XiaozhiAgentConfig</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%BF%AE%E6%94%B9XiaozhiAgent"><span class="toc-text">3、修改XiaozhiAgent</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E5%9B%9B%E3%80%81%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98-%E6%94%B9%E9%80%A0%E6%B5%81%E5%BC%8F%E8%BE%93%E5%87%BA"><span class="toc-text">十四、项目实战-改造流式输出</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="toc-text">1、添加依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AE%E6%B5%81%E5%BC%8F%E8%BE%93%E5%87%BA%E6%A8%A1%E5%9E%8B"><span class="toc-text">2、配置流式输出模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E7%BC%96%E7%A0%81"><span class="toc-text">3、编码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-text">3、测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%BA%94%E3%80%81%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98-%E8%BF%90%E8%A1%8C%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B"><span class="toc-text">十五、项目实战-运行前端工程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%AE%89%E8%A3%85Node-js"><span class="toc-text">1、安装Node.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AEnpm%E9%95%9C%E5%83%8F"><span class="toc-text">2、配置npm镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E8%BF%90%E8%A1%8C%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="toc-text">3、运行前端项目</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-color: transparent;"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">格言🧬</p><div class="bg-ad"><div>再看看那个光点，它就在这里，这是家园，这是我们 —— 你所爱的每一个人，你认识的一个人，你听说过的每一个人，曾经有过的每一个人，都在它上面度过他们的一生✨</div><div class="btn-xz-box"><a class="btn-xz" href="#">点击开启星辰之旅</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">猜你想看💡</p><ul class="ft-links"><li><a href="/social/link/">我的朋友</a><a href="/comments/">留点什么</a></li><li><a href="/personal/about/">关于作者</a><a href="/archives/">文章归档</a></li><li><a href="/categories/">文章分类</a><a href="/tags/">文章标签</a></li><li><a href="/box/Gallery/">我的画廊</a><a href="/personal/bb/">我的唠叨</a></li><li><a href="/site/time/">建设进程</a><a href="/site/census/">网站统计</a></li></ul></div></div></div><div class="ft-item-2"><p class="ft-t">推荐友链⌛</p><div class="ft-img-group"></div></div></div><div class="copyright"><span><b>&copy;2025</b></span><span><b>&nbsp;&nbsp;By Yangjiayu</b></span></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="博客框架为Hexo_v6.3.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Frame-Hexo-blue.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="主题版本Butterfly_v4.3.1"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Theme-Butterfly-6513df.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" title="本站采用多线部署，主线路托管于Vercel"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Hosted-Vercel-brightgreen.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://user.51.la/" style="margin-inline:5px" title="本站数据分析得益于51la技术支持"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Analytics-51la-3db1eb.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20226665" style="margin-inline:5px" title="本站已加入萌ICP豪华套餐，萌ICP备20226665号"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/萌ICP备-20226665-fe1384.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://bitiful.dogecast.com/buckets" style="margin-inline:5px" title="本网站经Service Worker分流至缤纷云对象存储"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Bucket-缤纷云-9c62da.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://www.netdun.net/" style="margin-inline:5px" title="本站使用网盾星球提供CDN加速与防护"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/CDN-网盾星球-fff2cc.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="本网站源码由Github提供存储仓库"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Source-Github-d021d6.svg" alt=""/></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="右键模式" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog right_side"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button class="share" type="button" title="分享链接" onclick="share()"><i class="fas fa-share-nodes"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>复制</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>百度搜索</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>转到链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>粘贴</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>空降评论</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>复制本文地址</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>新窗口打开</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>转到链接</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>保存图片</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>在新窗口打开</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制图片链接</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><i class="fa fa-paper-plane"></i><span>随便逛逛</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>昼夜切换</span></a><a class="rightMenu-item" href="/personal/about/"><i class="fa fa-info-circle"></i><span>关于博客</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><i class="fas fa-cog"></i><span>美化设置</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>切换全屏</span></a><a class="rightMenu-item" href="javascript:window.print();"><i class="fa-solid fa-print"></i><span>打印页面</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/node-snackbar/0.1.16/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000);
document.getElementById('loading-box').addEventListener('click',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://www.312782.xyz/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://www.312782.xyz/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.staticfile.org/twikoo/1.6.8/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script async src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer src="https://cdn1.tianli0.top/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script async src="//at.alicdn.com/t/c/font_3586335_hsivh70x0fm.js"></script><script async src="//at.alicdn.com/t/c/font_3636804_gr02jmjr3y9.js"></script><script async src="//at.alicdn.com/t/c/font_3612150_kfv55xn3u2g.js"></script><script async src="https://cdn.wpon.cn/2022-sucai/Gold-ingot.js"></script><canvas id="universe"></canvas><canvas id="snow"></canvas><script defer src="/js/fomal.js"></script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn1.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax","#bibi","body > title","#app","#tag-echarts","#posts-echart","#categories-echarts"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><a class="magnet_link_more"  href="https://yjyrichard.github.io/categories/" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(33.333333333333336% - 5px);background: #e9e9e9;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: var(--text-bg-hover)}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/d522d575.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bilibili123.oss-cn-beijing.aliyuncs.com/websitepic/12.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/d522d575.html&quot;);" href="javascript:void(0);" alt="">小程序起步</a><div class="blog-slider__text">初识小程序</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/d522d575.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/8610680.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bilibili123.oss-cn-beijing.aliyuncs.com/websitepic/5.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/8610680.html&quot;);" href="javascript:void(0);" alt="">大模型的token究竟是啥?</a><div class="blog-slider__text">大模型的token究竟是啥?</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/8610680.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/5c2f4951.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bilibili123.oss-cn-beijing.aliyuncs.com/websitepic/16.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/5c2f4951.html&quot;);" href="javascript:void(0);" alt="">基础数据结构(3)</a><div class="blog-slider__text">栈，队列，堆，二叉树</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/5c2f4951.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/45347810.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bilibili123.oss-cn-beijing.aliyuncs.com/websitepic/4.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/45347810.html&quot;);" href="javascript:void(0);" alt="">基础数据结构(2)</a><div class="blog-slider__text">递归</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/45347810.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/6e192bd3.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bilibili123.oss-cn-beijing.aliyuncs.com/websitepic/11.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/6e192bd3.html&quot;);" href="javascript:void(0);" alt="">基础数据结构(1)</a><div class="blog-slider__text">数组与链表</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/6e192bd3.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/3ec27523.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bilibili123.oss-cn-beijing.aliyuncs.com/websitepic/9.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-21</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/3ec27523.html&quot;);" href="javascript:void(0);" alt="">微信支付</a><div class="blog-slider__text">java整合微信的网页支付包含原理</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/3ec27523.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('blog-slider swiper-container-fade swiper-container-horizontal');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('catalog_magnet');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '1.5s·');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('pagination');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__jackInTheBox');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('gitZone');
      var item_html = '<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 320px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('已挂载gitcalendar')
      }

    if( document.getElementById('gitZone') && (location.pathname ==='/site/census/'|| '/site/census/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("/api?null",['#d9e0df', '#c6e0dc', '#a8dcd4', '#9adcd2', '#89ded1', '#77e0d0', '#5fdecb', '#47dcc6', '#39dcc3', '#1fdabe', '#00dab9'],'null')
    }
  </script><!-- hexo injector body_end end --></body></html>